>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
CPC2198: Current library changed to NLITTEN1.
CPC2196: Library NLITTEN1 added to library list.

>> executing command: CRTSQLRPGI srcstmf('/home/nlitten/builds/nick.litten.public/subfile-samples/CRUD01RPG-Change_Read_Update_Delete_Example.pgm.sqlrpgle') OBJ(NLITTEN1/CRUD01RPG) COMMIT(*NONE ) OBJTYPE(*PGM) OPTION(*EVENTF) OUTPUT(*PRINT) TEXT('Change Read Update Delete Example') TGTRLS(V7R4M0) DBGVIEW(*SOURCE) RPGPPOPT(*LVL2) COMPILEOPT('TGTCCSID(*JOB) OPTIMIZE(*FULL) INCDIR(''includes'')')
>> liblist: QSYS QSYS2 QHLPSYS QUSRSYS QSHELL NLITTEN1 NLITTEN1 QTEMP QGPL
>> executing time: 2025-04-11-10.38.41.00

SQL9001: SQL precompile failed.
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      1
  Command  . . . . . . . . . . . . :   CRTBNDRPG
    Issued by  . . . . . . . . . . :     NICKLITTEN
  Program  . . . . . . . . . . . . :   CRUD01RPG
    Library  . . . . . . . . . . . :     NLITTEN1
  Text 'description' . . . . . . . :   Change Read Update Delete Example
  Source stream file   . . . . . . :   /home/nlitten/builds/nick.litten.public/subfile-sa
                                       mples/CRUD01RPG-Change_Read_Update_Delete_Example.
                                       pgm.sqlrpgle
    CCSID  . . . . . . . . . . . . :     1208
  Target CCSID . . . . . . . . . . :   *JOB (37)
  Text 'description' . . . . . . . :
  Last Change  . . . . . . . . . . :   25-04-04  16:54:11
  Generation severity level  . . . :   10
  Default activation group . . . . :   *YES
  Compiler options . . . . . . . . :   *XREF      *GEN       *NOSECLVL  *SHOWCPY
                                       *EXPDDS    *EXT       *NOSHOWSKP *NOSRCSTMT
                                       *DEBUGIO   *UNREF     *EVENTF
  Debugging views  . . . . . . . . :   *ALL
  Debug encryption key . . . . . . :   *NONE
  Output . . . . . . . . . . . . . :   *PRINT
  Optimization level . . . . . . . :   *FULL
  Source listing indentation . . . :   *NONE
  Type conversion options  . . . . :   *NONE
  Sort sequence  . . . . . . . . . :   *JOB
  Language identifier  . . . . . . :   *JOB
  Replace program  . . . . . . . . :   *YES
  User profile . . . . . . . . . . :   *USER
  Authority  . . . . . . . . . . . :   *LIBCRTAUT
  Truncate numeric . . . . . . . . :   *YES
  Fix numeric  . . . . . . . . . . :   *NONE
  Target release . . . . . . . . . :   V7R4M0
  Allow null values  . . . . . . . :   *NO
  Define condition names . . . . . :   *NONE
  Enable performance collection  . :   *PEP
  Profiling data . . . . . . . . . :   *NOCOL
  Licensed Internal Code options . :
  Generate program interface . . . :   *NO
  Include directory  . . . . . . . :   includes
  Preprocessor options . . . . . . :   *NORMVCOMMENT *EXPINCLUDE   *NOSEQSRC
  Output source file . . . . . . . :   QSQLPRE
    Library  . . . . . . . . . . . :     QTEMP
  Output source member . . . . . . :   CRUD01RPG
  MINIMUM OUTPUT LINE LENGTH . . . :   100
  Require prototype for export . . :   *NO
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      2
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
                          S o u r c e   L i s t i n g
     1 **free                                                                                                               000001
     2 // --------------------------------------------------------------------------                                        000002
     3 // CRUD for single file, with subfile using SQLRPGLE                                                                 000003
     4 // --------------------------------------------------------------------------                                        000004
     5                                                                                                                      000005
     6 ctl-opt copyright('| CRUD01RPG 2018.09.27')                                                                          000006
     7  main(mainline);                                                                                                     000007
     8                                                                                                                      000008
     9 dcl-f CRUD01PNL workstn sfile(SFLTASK:taskrrn) usropn infds(infds);                                                  000009
    10                                                                                                                      000010
    11 // Validation indicators                                                                                             000011
    12 Dcl-S pIndicators Pointer Inz(%Addr(*In));                                                                           000012
    13 Dcl-Ds DspInd Based(pIndicators);                                                                                    000013
    14   // Subfile indicators                                                                                              000014
    15   SflDsp          Ind Pos(99);                                                                                       000015
    16   SflDspCtl       Ind Pos(98);                                                                                       000016
    17   SflClr          Ind Pos(97);                                                                                       000017
    18   SflEnd          Ind Pos(96);                                                                                       000018
    19   // Validation Errors                                                                                               000019
    20   Taskidexisterror_31 Ind Pos(31);                                                                                   000020
    21   Startdateerror_32  Ind Pos(32);                                                                                    000021
    22   Enddateerror_33 Ind Pos(33);                                                                                       000022
    23   Dategreaterthanerror_34 Ind Pos(34);                                                                               000023
    24   ProtectFields_35 Ind Pos(35);                                                                                      000024
    25   ProtectFields_36 Ind Pos(36);                                                                                      000025
    26   IndErrors char(20) Pos(31);                                                                                        000026
    27 end-ds;                                                                                                              000027
    28                                                                                                                      000028
    29 // Variable Pointer for SQL Errors                                                                                   000029
    30 Dcl-S pSqlstate Pointer Inz(%Addr(SQLState));                                                                        000030
    31                                                                                                                      000031
    32 Dcl-Ds Ds_SqlState based(pSqlstate);                                                                                 000032
    33   xSqlstate char(2);                                                                                                 000033
    34 end-ds;                                                                                                              000034
    35                                                                                                                      000035
    36 // Constant error on SQL                                                                                             000036
    37 Dcl-C SUCCESS_ON_SQL '00';                                                                                           000037
    38 Dcl-C WARNING_ON_SQL '01';                                                                                           000038
    39 Dcl-C NODATA_ON_SQL  '02';                                                                                           000039
    40                                                                                                                      000040
    41 // Data structure based in the query neccesary for fill the subfile of                                               000041
    42 // the file CRUD01TBL                                                                                                000042
    43 Dcl-Ds Ds_taskdata qualified;                                                                                        000043
    44   Taskid     zoned(10);                                                                                              000044
    45   Nametask    char(20);                                                                                              000045
    46   Start_date zoned(8);                                                                                               000046
    47   End_date   zoned(8);                                                                                               000047
    48   Taskstate  zoned(1);                                                                                               000048
    49 end-ds;                                                                                                              000049
    50                                                                                                                      000050
    51 // Data structure for general use in CRUD operations                                                                 000051
    52 Dcl-Ds Ds_datacrud extname('CRUD01TBL') qualified end-ds;                                                            000052
    53                                                                                                                      000053
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      3
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
    54 // Relative record number for SFLTASK subfile task                                                                   000054
    55 Dcl-S taskrrn zoned(3:0);                                                                                            000055
    56                                                                                                                      000056
    57 // Variables for subfile scroll position                                                                             000057
    58 Dcl-S Initialpos zoned(10:0) inz(0);                                                                                 000058
    59 Dcl-S Finalpos zoned(10:0) inz(10);                                                                                  000059
    60                                                                                                                      000060
    61 // Previous initial and finalpos for indicates final                                                                 000061
    62 Dcl-S Previnitialpos zoned(10:0);                                                                                    000062
    63 Dcl-S PrevFinalpos zoned(10:0) ;                                                                                     000063
    64                                                                                                                      000064
    65 // Variable for apply filter to subfile query                                                                        000065
    66 Dcl-S w_Wheresfl char(500) inz(*blanks);                                                                             000066
    67                                                                                                                      000067
    68 // Quantity of records per page in subfile change the inz value depend                                               000068
    69 // of your subfile capacity                                                                                          000069
    70 Dcl-C PERPAGE 10;                                                                                                    000070
    71                                                                                                                      000071
    72 // Variable for indicates that crud operations are finalized                                                         000072
    73 Dcl-S w_Crudfinalize Ind;                                                                                            000073
    74                                                                                                                      000074
    75 // Variable with current user                                                                                        000075
    76 Dcl-S CurrentUser char(10) inz(*user);                                                                               000076
    77                                                                                                                      000077
    78                                                                                                                      000078
    79                                                                                                                      000079
    80                                                                                                                      000080
    81                                                                                                                      000081
    82                                                                                                                      000082
    83 // --------------------------------------------------------------------------                                        000083
    84 // This is the mainline process that is executed when the program is called                                          000084
    85 // --------------------------------------------------------------------------                                        000085
    86 Dcl-Proc mainline;                                                                                                   000086
    87                                                                                                                      000087
    88   Dcl-S choice char(1) inz(*blanks);                                                                                 000088
    89                                                                                                                      000089
    90   open CRUD01PNL;                                                                                                    000090
    91                                                                                                                      000091
    92   // The value 'S' is for Subfile Menu                                                                               000092
    93   choice = 'S';                                                                                                      000093
    94                                                                                                                      000094
    95   ShowScreen(choice);                                                                                                000095
    96                                                                                                                      000096
    97   // Termination of program                                                                                          000097
    98   close CRUD01PNL;                                                                                                   000098
    99   *Inlr = *On;                                                                                                       000099
   100 end-proc;                                                                                                            000100
   101                                                                                                                      000101
   102                                                                                                                      000102
   103                                                                                                                      000103
   104                                                                                                                      000104
   105                                                                                                                      000105
   106                                                                                                                      000106
   107 // --------------------------------------------------------------------------                                        000107
   108 // This procedure receives a parameter for the titles that are written                                               000108
   109 // --------------------------------------------------------------------------                                        000109
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      4
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   110 Dcl-Proc WriteScreen;                                                                                                000110
   111   Dcl-Pi WriteScreen;                                                                                                000111
   112     p_choice char(1);                                                                                                000112
   113   end-pi;                                                                                                            000113
   114                                                                                                                      000114
   115   // Secondary titles                                                                                                000115
   116   TITLE2 = Center('Created by Some Bloke':%len(TITLE2));                                                             000116
   117   TITLE3 = Center('Back in 2018':%len(TITLE3));                                                                      000117
   118                                                                                                                      000118
   119   // Principal title                                                                                                 000119
   120   Select;                                                                                                            000120
   121                                                                                                                      000121
   122       // CRUD Options                                                                                                000122
   123     When (p_choice = 'I');                                                                                           000123
   124       TITLE1 = Center('TASKS ADMINISTRATOR INSERT':%len(TITLE1));                                                    000124
   125     When (p_choice = 'M');                                                                                           000125
   126       TITLE1 = Center('TASKS ADMINISTRATOR MODIFY':%len(TITLE1));                                                    000126
   127     When (p_choice = 'D');                                                                                           000127
   128       TITLE1 = Center('TASKS ADMINISTRATOR DELETE':%len(TITLE1));                                                    000128
   129     When (p_choice = 'V');                                                                                           000129
   130       TITLE1 = Center('TASKS ADMINISTRATOR VIEW':%len(TITLE1));                                                      000130
   131                                                                                                                      000131
   132       // Subfile                                                                                                     000132
   133     When (p_choice = 'S');                                                                                           000133
   134       TITLE1 = Center('TASKS ADMINISTRATOR MAIN MENU':%len(TITLE1));                                                 000134
   135   EndSl;                                                                                                             000135
   136                                                                                                                      000136
   137   // Use an IF/ELSEIF as a different way of doing SELECT groups                                                      000137
   138   // here is an example:                                                                                             000138
   139   If (p_choice = 'S');                                                                                               000139
   140     FOOTTEXT = 'F3=Exit  F5=Refresh  F6=Create';                                                                     000140
   141   elseif (p_choice = 'I' or p_choice= 'M' or p_choice= 'D');                                                         000141
   142     FOOTTEXT = 'F3=Exit      F10=Confirm';                                                                           000142
   143   elseif (p_choice = 'V');                                                                                           000143
   144     FOOTTEXT = 'F3=Exit  ';                                                                                          000144
   145   EndIf;                                                                                                             000145
   146                                                                                                                      000146
   147   write HEADER;                                                                                                      000147
   148   write FOOTER;                                                                                                      000148
   149 end-proc;                                                                                                            000149
   150                                                                                                                      000150
   151                                                                                                                      000151
   152                                                                                                                      000152
   153                                                                                                                      000153
   154                                                                                                                      000154
   155                                                                                                                      000155
   156                                                                                                                      000156
   157                                                                                                                      000157
   158                                                                                                                      000158
   159                                                                                                                      000159
   160                                                                                                                      000160
   161                                                                                                                      000161
   162 // --------------------------------------------------------------------------                                        000162
   163 // This procedure executes and show the screen choiced by parameter                                                  000163
   164 // --------------------------------------------------------------------------                                        000164
   165 Dcl-Proc ShowScreen;                                                                                                 000165
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      5
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   166   Dcl-Pi ShowScreen ;                                                                                                000166
   167     p_choice char(1);                                                                                                000167
   168   end-pi;                                                                                                            000168
   169                                                                                                                      000169
   170   Select;                                                                                                            000170
   171     When (p_choice = 'I');                                                                                           000171
   172       InsertScreen(p_choice);                                                                                        000172
   173     When (p_choice = 'S');                                                                                           000173
   174       ShowSubfile(p_choice);                                                                                         000174
   175     When (p_choice = 'M');                                                                                           000175
   176       ModifyScreen(p_choice);                                                                                        000176
   177     When (p_choice = 'D');                                                                                           000177
   178       DeleteScreen(p_choice);                                                                                        000178
   179     When (p_choice = 'V');                                                                                           000179
   180       ViewScreen(p_choice);                                                                                          000180
   181   EndSl;                                                                                                             000181
   182                                                                                                                      000182
   183 end-proc;                                                                                                            000183
   184                                                                                                                      000184
   185                                                                                                                      000185
   186                                                                                                                      000186
   187                                                                                                                      000187
   188                                                                                                                      000188
   189                                                                                                                      000189
   190                                                                                                                      000190
   191 // --------------------------------------------------------------------------                                        000191
   192 // Show Window to user for confirm the current action                                                                000192
   193 // --------------------------------------------------------------------------                                        000193
   194 Dcl-Proc ShowWdw;                                                                                                    000194
   195   Dcl-Pi ShowWdw;                                                                                                    000195
   196     p_choice char(1);                                                                                                000196
   197   end-pi;                                                                                                            000197
   198                                                                                                                      000198
   199   // 'C' for confirm save record in database                                                                         000199
   200   If (p_choice = 'C');                                                                                               000200
   201     WDWTEXT1 = 'Are you sure to execute this action?';                                                               000201
   202     WDWTEXT2 = 'Please type Y/N ';                                                                                   000202
   203     write WDWCONFIRM;                                                                                                000203
   204     exfmt WDWCONFIRM;                                                                                                000204
   205   EndIf;                                                                                                             000205
   206                                                                                                                      000206
   207   // 'M' for message information                                                                                     000207
   208   If (p_choice = 'M');                                                                                               000208
   209     WDWMSG1 = 'Your record has been saved';                                                                          000209
   210     exfmt WDWMESSAGE;                                                                                                000210
   211   EndIf;                                                                                                             000211
   212                                                                                                                      000212
   213   If (p_choice = 'D');                                                                                               000213
   214     WDWMSG1 = 'Your record has been deleted';                                                                        000214
   215     exfmt WDWMESSAGE;                                                                                                000215
   216   EndIf;                                                                                                             000216
   217                                                                                                                      000217
   218   // 'E' for error message                                                                                           000218
   219   If (p_choice = 'E');                                                                                               000219
   220     WDWMSG1 = 'Error executing this action ';                                                                        000220
   221     exfmt WDWMESSAGE;                                                                                                000221
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      6
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   222   EndIf;                                                                                                             000222
   223                                                                                                                      000223
   224 end-proc;                                                                                                            000224
   225                                                                                                                      000225
   226                                                                                                                      000226
   227                                                                                                                      000227
   228                                                                                                                      000228
   229                                                                                                                      000229
   230                                                                                                                      000230
   231                                                                                                                      000231
   232                                                                                                                      000232
   233                                                                                                                      000233
   234                                                                                                                      000234
   235                                                                                                                      000235
   236 // --------------------------------------------------------------------------                                        000236
   237 // This procedure Center the titles of the screen                                                                    000237
   238 // --------------------------------------------------------------------------                                        000238
   239 Dcl-Proc Center;                                                                                                     000239
   240   Dcl-Pi Center char(80);                                                                                            000240
   241     Par_Text char(80) value;                                                                                         000241
   242     Par_Length zoned(2:0) value;                                                                                     000242
   243   end-pi;                                                                                                            000243
   244                                                                                                                      000244
   245   // Local variables                                                                                                 000245
   246   Dcl-S LenBlanks zoned(2:0);                                                                                        000246
   247   Dcl-S InitPosition zoned(2:0);                                                                                     000247
   248   Dcl-S Centeredtext char(80);                                                                                       000248
   249                                                                                                                      000249
   250   LenBlanks= Par_Length - %Len(%Trim(Par_Text));                                                                     000250
   251   InitPosition = LenBlanks /2;                                                                                       000251
   252   %Subst(Centeredtext:InitPosition)= %Trim(Par_Text);                                                                000252
   253   Return Centeredtext;                                                                                               000253
   254                                                                                                                      000254
   255 end-proc;                                                                                                            000255
   256                                                                                                                      000256
   257                                                                                                                      000257
   258                                                                                                                      000258
   259                                                                                                                      000259
   260                                                                                                                      000260
   261                                                                                                                      000261
   262                                                                                                                      000262
   263                                                                                                                      000263
   264 // --------------------------------------------------------------------------                                        000264
   265 // Show the subfile in the screen                                                                                    000265
   266 // --------------------------------------------------------------------------                                        000266
   267 Dcl-Proc ShowSubfile;                                                                                                000267
   268   Dcl-Pi ShowSubfile;                                                                                                000268
   269     p_choice char(1);                                                                                                000269
   270   end-pi;                                                                                                            000270
   271                                                                                                                      000271
   272   Dcl-S w_exist char(1);                                                                                             000272
   273   Dcl-S choice char(1);                                                                                              000273
   274                                                                                                                      000274
   275   dow (not pfkey(03));                                                                                               000275
   276     WriteScreen(p_choice);                                                                                           000276
   277     ActivateSubfile();                                                                                               000277
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      7
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   278     exfmt SFLTASKCTL;                                                                                                000278
   279                                                                                                                      000279
   280     Select ;                                                                                                         000280
   281       When (pfkey(03));                                                                                              000281
   282         pfkey(03) = *Off;                                                                                            000282
   283         reset Initialpos;                                                                                            000283
   284         reset Finalpos;                                                                                              000284
   285         leave;                                                                                                       000285
   286       When (infds.funcKey = Pageup);                                                                                 000286
   287         If (Initialpos = 0 and Finalpos = 10);                                                                       000287
   288           iter;                                                                                                      000288
   289         elseif (Initialpos > 1 and Finalpos > 10);                                                                   000289
   290           Initialpos -= 11;                                                                                          000290
   291           Finalpos -= 10;                                                                                            000291
   292           ShowScreen(p_choice);                                                                                      000292
   293           leave;                                                                                                     000293
   294         EndIf;                                                                                                       000294
   295                                                                                                                      000295
   296       When (infds.funcKey = PageDn);                                                                                 000296
   297                                                                                                                      000297
   298         If (Initialpos > 0 and Finalpos > 10);                                                                       000298
   299                                                                                                                      000299
   300           exec sql                                                                                                   000300
   301           SELECT '1'                                                                                                 000301
   302             INTO : w_exist                                                                                           000302
   303             FROM (SELECT A.*,                                                                                        000303
   304                          RowNumber()                                                                                 000304
   305                     Over()                                                                                           000305
   306                     as RNum                                                                                          000306
   307                     FROM CRUD01TBL AS A                                                                              000307
   308                     Where 1 = 1)                                                                                     000308
   309             as Tbl                                                                                                   000309
   310             Where RNum BetWeen : Initialpos AND                                                                      000310
   311                   :Finalpos                                                                                          000311
   312             FETCH FIRST ROW ONLY;                                                                                    000312
   313                                                                                                                      000313
   314           If (w_exist <> '1');                                                                                       000314
   315             Initialpos -= 11;                                                                                        000315
   316             Finalpos -= 10;                                                                                          000316
   317           EndIf;                                                                                                     000317
   318                                                                                                                      000318
   319           ShowScreen(p_choice);                                                                                      000319
   320           leave;                                                                                                     000320
   321                                                                                                                      000321
   322         Else;                                                                                                        000322
   323           ShowScreen(p_choice);                                                                                      000323
   324           leave;                                                                                                     000324
   325         EndIf;                                                                                                       000325
   326                                                                                                                      000326
   327       When (pfkey(05));                                                                                              000327
   328                                                                                                                      000328
   329         reset Initialpos;                                                                                            000329
   330         reset Finalpos;                                                                                              000330
   331                                                                                                                      000331
   332         ShowScreen(p_choice);                                                                                        000332
   333         leave;                                                                                                       000333
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      8
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   334       When (pfkey(06));                                                                                              000334
   335         choice = 'I';                                                                                                000335
   336         ShowScreen(choice);                                                                                          000336
   337         leave;                                                                                                       000337
   338       Other;                                                                                                         000338
   339         reset w_Wheresfl;                                                                                            000339
   340                                                                                                                      000340
   341         // if there are selected records in subfile then executes                                                    000341
   342         If (taskrrn > *zeros);                                                                                       000342
   343           for taskrrn = 1 to PERPAGE;                                                                                000343
   344             chain taskrrn SFLTASK;                                                                                   000344
   345             If (%found());                                                                                           000345
   346                                                                                                                      000346
   347               Select;                                                                                                000347
   348                 When (OPCTASK = '2');                                                                                000348
   349                                                                                                                      000349
   350                   clear Ds_datacrud;                                                                                 000350
   351                                                                                                                      000351
   352                   // Loads the data into data structure                                                              000352
   353                   exec sql                                                                                           000353
   354                 SELECT * INTO:Ds_datacrud                                                                            000354
   355                   FROM CRUD01TBL                                                                                     000355
   356                   WHERE TASK_ID = : SFLTASKID;                                                                       000356
   357                                                                                                                      000357
   358                   choice = 'M';                                                                                      000358
   359                   ShowScreen(choice);                                                                                000359
   360                   leave;                                                                                             000360
   361                 When (OPCTASK = '4');                                                                                000361
   362                   clear Ds_datacrud;                                                                                 000362
   363                                                                                                                      000363
   364                   // Loads the data into data structure                                                              000364
   365                   exec sql                                                                                           000365
   366                 SELECT * INTO:Ds_datacrud                                                                            000366
   367                   FROM CRUD01TBL                                                                                     000367
   368                   WHERE TASK_ID = : SFLTASKID;                                                                       000368
   369                                                                                                                      000369
   370                   choice = 'D';                                                                                      000370
   371                   ShowScreen(choice);                                                                                000371
   372                   leave;                                                                                             000372
   373                 When (OPCTASK = '5');                                                                                000373
   374                   clear Ds_datacrud;                                                                                 000374
   375                                                                                                                      000375
   376                   // Loads the data into data structure                                                              000376
   377                   exec sql                                                                                           000377
   378                 SELECT * INTO:Ds_datacrud                                                                            000378
   379                   FROM CRUD01TBL                                                                                     000379
   380                   WHERE TASK_ID = : SFLTASKID;                                                                       000380
   381                                                                                                                      000381
   382                   choice = 'V';                                                                                      000382
   383                   ShowScreen(choice);                                                                                000383
   384                   leave;                                                                                             000384
   385               EndSl;                                                                                                 000385
   386               // Clean the field                                                                                     000386
   387               OPCTASK = *Blanks;                                                                                     000387
   388               Update SFLTASK;                                                                                        000388
   389             Else;                                                                                                    000389
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page      9
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   390               leave;                                                                                                 000390
   391             EndIf;                                                                                                   000391
   392           endfor;                                                                                                    000392
   393         EndIf;                                                                                                       000393
   394     EndSl;                                                                                                           000394
   395     If (w_Crudfinalize = *On);                                                                                       000395
   396       w_Crudfinalize = *Off;                                                                                         000396
   397       leave;                                                                                                         000397
   398     EndIf;                                                                                                           000398
   399                                                                                                                      000399
   400   enddo;                                                                                                             000400
   401                                                                                                                      000401
   402 end-proc ;                                                                                                           000402
   403                                                                                                                      000403
   404                                                                                                                      000404
   405                                                                                                                      000405
   406                                                                                                                      000406
   407                                                                                                                      000407
   408                                                                                                                      000408
   409                                                                                                                      000409
   410 // --------------------------------------------------------------------------                                        000410
   411 // handle all screen validation                                                                                      000411
   412 // --------------------------------------------------------------------------                                        000412
   413 Dcl-Proc ScreenValidation ;                                                                                          000413
   414   Dcl-Pi ScreenValidation Ind;                                                                                       000414
   415     p_choice char(1);                                                                                                000415
   416   end-pi;                                                                                                            000416
   417                                                                                                                      000417
   418   Dcl-S w_ValidisnotOK Ind;                                                                                          000418
   419   Dcl-S w_Exists char(1);                                                                                            000419
   420                                                                                                                      000420
   421   // Set zeros in general variable based in DspInd                                                                   000421
   422   IndErrors = *zeros;                                                                                                000422
   423                                                                                                                      000423
   424   If (p_choice = 'I'); // Validations for Insert                                                                     000424
   425                                                                                                                      000425
   426     TurnoffErrors();                                                                                                 000426
   427                                                                                                                      000427
   428     // Search Task id entered into database                                                                          000428
   429     exec sql                                                                                                         000429
   430       SELECT '1'                                                                                                     000430
   431         INTO : w_Exists                                                                                              000431
   432         FROM CRUD01TBL                                                                                               000432
   433         WHERE TASK_ID = :CRUDTASKID;                                                                                 000433
   434                                                                                                                      000434
   435     Taskidexisterror_31 = (w_Exists = '1');                                                                          000435
   436                                                                                                                      000436
   437     // Validation of dates                                                                                           000437
   438     test(De) *iso STARTDATE; //Validates if date is in YYYYMMDD                                                      000438
   439                                                                                                                      000439
   440     Startdateerror_32 = %error;                                                                                      000440
   441                                                                                                                      000441
   442     test(De) *iso ENDDATE;                                                                                           000442
   443                                                                                                                      000443
   444     Enddateerror_33 = %error;                                                                                        000444
   445                                                                                                                      000445
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     10
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   446     If (STARTDATE <> *zeros and ENDDATE <> *zeros                                                                    000446
   447         and Startdateerror_32 = *Off and Enddateerror_33 = *Off);                                                    000447
   448       If (STARTDATE > ENDDATE);                                                                                      000448
   449         Dategreaterthanerror_34 = *On;                                                                               000449
   450       EndIf;                                                                                                         000450
   451     EndIf;                                                                                                           000451
   452   EndIf;                                                                                                             000452
   453                                                                                                                      000453
   454   w_ValidisnotOK = IndErrors <> *Zeros;                                                                              000454
   455                                                                                                                      000455
   456   Return w_ValidisnotOK;                                                                                             000456
   457 end-proc;                                                                                                            000457
   458                                                                                                                      000458
   459                                                                                                                      000459
   460                                                                                                                      000460
   461                                                                                                                      000461
   462                                                                                                                      000462
   463                                                                                                                      000463
   464 // --------------------------------------------------------------------------                                        000464
   465 // reset errors                                                                                                      000465
   466 // --------------------------------------------------------------------------                                        000466
   467 Dcl-Proc TurnoffErrors;                                                                                              000467
   468   Taskidexisterror_31 = *Off;                                                                                        000468
   469   Startdateerror_32 = *Off;                                                                                          000469
   470   Enddateerror_33 = *Off;                                                                                            000470
   471   Dategreaterthanerror_34 = *Off;                                                                                    000471
   472 end-proc ;                                                                                                           000472
   473                                                                                                                      000473
   474                                                                                                                      000474
   475                                                                                                                      000475
   476                                                                                                                      000476
   477                                                                                                                      000477
   478 // --------------------------------------------------------------------------                                        000478
   479 // This procedure set the sql variable to the procedure to                                                           000479
   480 // populate the subfile with data based in the customized                                                            000480
   481 // sql variable                                                                                                      000481
   482 // --------------------------------------------------------------------------                                        000482
   483 Dcl-Proc SubfileStart;                                                                                               000483
   484   Dcl-Pi SubfileStart;                                                                                               000484
   485   end-pi;                                                                                                            000485
   486                                                                                                                      000486
   487   // Variable for store the sql query required                                                                       000487
   488   Dcl-S sqlcustomized char(500);                                                                                     000488
   489                                                                                                                      000489
   490   sqlcustomized = 'SELECT TASK_ID , NAME , STARTDATE , ENDDATE , STATE '+                                            000490
   491                   'FROM (SELECT A.*, RowNumber() Over() as RNum FROM '+                                              000491
   492                   'CRUD01TBL AS A Where 1=1) as Tbl Where RNum '+                                                    000492
   493                   'BetWeen '+%char(Initialpos)+' and '+%char(Finalpos) +                                             000493
   494                   ' '+%trim(w_Wheresfl);                                                                             000494
   495                                                                                                                      000495
   496   FillSfl(sqlcustomized);                                                                                            000496
   497                                                                                                                      000497
   498 end-proc;                                                                                                            000498
   499                                                                                                                      000499
   500                                                                                                                      000500
   501                                                                                                                      000501
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     11
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   502                                                                                                                      000502
   503                                                                                                                      000503
   504 // --------------------------------------------------------------------------                                        000504
   505 // Initialize and prepare the subfile                                                                                000505
   506 // --------------------------------------------------------------------------                                        000506
   507 Dcl-Proc Sflinitial;                                                                                                 000507
   508   SflEnd = *off;                                                                                                     000508
   509   SflClr = *on;                                                                                                      000509
   510   write SFLTASKCTL;                                                                                                  000510
   511   SflClr = *off;                                                                                                     000511
   512   taskrrn = *zeros;                                                                                                  000512
   513   SflDsp = *off;                                                                                                     000513
   514   SflDspCtl = *off;                                                                                                  000514
   515 end-proc;                                                                                                            000515
   516                                                                                                                      000516
   517                                                                                                                      000517
   518                                                                                                                      000518
   519                                                                                                                      000519
   520                                                                                                                      000520
   521                                                                                                                      000521
   522                                                                                                                      000522
   523 // --------------------------------------------------------------------------                                        000523
   524 // Activate the subfile for being displayed on screen                                                                000524
   525 // --------------------------------------------------------------------------                                        000525
   526 Dcl-Proc ActivateSubfile;                                                                                            000526
   527   Sflinitial();                                                                                                      000527
   528   SubfileStart();                                                                                                    000528
   529                                                                                                                      000529
   530   SflEnd = Gettotalrecords() < 10;                                                                                   000530
   531                                                                                                                      000531
   532   If (taskrrn > 0);                                                                                                  000532
   533     SflDsp = *On;                                                                                                    000533
   534   Else;                                                                                                              000534
   535     write EMPTY;                                                                                                     000535
   536   EndIf;                                                                                                             000536
   537                                                                                                                      000537
   538   SflDspCtl = *On;                                                                                                   000538
   539 end-proc;                                                                                                            000539
   540                                                                                                                      000540
   541                                                                                                                      000541
   542                                                                                                                      000542
   543                                                                                                                      000543
   544                                                                                                                      000544
   545                                                                                                                      000545
   546                                                                                                                      000546
   547                                                                                                                      000547
   548 // --------------------------------------------------------------------------                                        000548
   549 // Fill the subfile with a Cursor                                                                                    000549
   550 // --------------------------------------------------------------------------                                        000550
   551 Dcl-Proc FillSfl;                                                                                                    000551
   552   Dcl-Pi FillSfl;                                                                                                    000552
   553     Par_sqlcustomized char(500);                                                                                     000553
   554   end-pi;                                                                                                            000554
   555                                                                                                                      000555
   556   Dcl-S Count zoned(2:0);                                                                                            000556
   557                                                                                                                      000557
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     12
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   558   Dcl-S LastRRN zoned(10:0);                                                                                         000558
   559                                                                                                                      000559
   560   // Set previous values for indicates final of subfile is it is                                                     000560
   561   // necessary                                                                                                       000561
   562   clear Previnitialpos;                                                                                              000562
   563   clear PrevFinalpos;                                                                                                000563
   564                                                                                                                      000564
   565   Previnitialpos = Initialpos;                                                                                       000565
   566   PrevFinalpos = Finalpos;                                                                                           000566
   567                                                                                                                      000567
   568   clear Ds_taskdata;                                                                                                 000568
   569                                                                                                                      000569
   570   exec sql                                                                                                           000570
   571     PREPARE YOURQUERY FROM : Par_sqlcustomized;                                                                      000571
   572                                                                                                                      000572
   573   exec sql                                                                                                           000573
   574     DECLARE TASK_CURSOR INSENSITIVE SCROLL CURSOR FOR YOURQUERY;                                                     000574
   575                                                                                                                      000575
   576   exec sql                                                                                                           000576
   577     OPEN TASK_CURSOR;                                                                                                000577
   578                                                                                                                      000578
   579   exec sql                                                                                                           000579
   580     FETCH NEXT FROM TASK_CURSOR INTO : Ds_taskdata;                                                                  000580
   581                                                                                                                      000581
   582   dow (xSQLState <> NODATA_ON_SQL) and (Count < PERPAGE);                                                            000582
   583     Count = Count+1;                                                                                                 000583
   584     LastRRN = LastRRN+1;                                                                                             000584
   585                                                                                                                      000585
   586     If (xSQLState = SUCCESS_ON_SQL);                                                                                 000586
   587       DatatoSfl();                                                                                                   000587
   588     EndIf;                                                                                                           000588
   589                                                                                                                      000589
   590     exec sql                                                                                                         000590
   591       FETCH NEXT FROM TASK_CURSOR INTO : Ds_taskdata;                                                                000591
   592     If (xSQLState <> SUCCESS_ON_SQL);                                                                                000592
   593       If (taskrrn = 10);                                                                                             000593
   594         Initialpos += Count+1;                                                                                       000594
   595         Finalpos += LastRRN;                                                                                         000595
   596       EndIf;                                                                                                         000596
   597     EndIf;                                                                                                           000597
   598   enddo;                                                                                                             000598
   599                                                                                                                      000599
   600   exec sql                                                                                                           000600
   601     CLOSE TASK_CURSOR;                                                                                               000601
   602 end-proc;                                                                                                            000602
   603                                                                                                                      000603
   604                                                                                                                      000604
   605                                                                                                                      000605
   606                                                                                                                      000606
   607                                                                                                                      000607
   608                                                                                                                      000608
   609                                                                                                                      000609
   610 // --------------------------------------------------------------------------                                        000610
   611 // This procedure assign the data fetched from cursor to subfile                                                     000611
   612 // --------------------------------------------------------------------------                                        000612
   613 Dcl-Proc DatatoSfl;                                                                                                  000613
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     13
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   614   taskrrn +=1;                                                                                                       000614
   615   SFLTASKID = Ds_taskdata.Taskid;                                                                                    000615
   616   SFLTASKNAM = Ds_taskdata.Nametask;                                                                                 000616
   617   SFLSTRDATE = Ds_taskdata.Start_date;                                                                               000617
   618   SFLENDDATE = Ds_taskdata.End_date;                                                                                 000618
   619   SFLSTATE = Ds_taskdata.Taskstate;                                                                                  000619
   620   write SFLTASK;                                                                                                     000620
   621   clear SFLTASK;                                                                                                     000621
   622 end-proc;                                                                                                            000622
   623                                                                                                                      000623
   624                                                                                                                      000624
   625                                                                                                                      000625
   626                                                                                                                      000626
   627                                                                                                                      000627
   628                                                                                                                      000628
   629                                                                                                                      000629
   630                                                                                                                      000630
   631 // --------------------------------------------------------------------------                                        000631
   632 // get total records                                                                                                 000632
   633 // --------------------------------------------------------------------------                                        000633
   634 Dcl-Proc Gettotalrecords;                                                                                            000634
   635   Dcl-Pi Gettotalrecords zoned(10);                                                                                  000635
   636   end-pi;                                                                                                            000636
   637                                                                                                                      000637
   638   Dcl-S w_Total zoned(10:0);                                                                                         000638
   639                                                                                                                      000639
   640   Dcl-S sqlcustomized char(500);                                                                                     000640
   641                                                                                                                      000641
   642   sqlcustomized = 'SELECT COUNT(*) '+                                                                                000642
   643          'FROM (SELECT A.*, RowNumber() Over() as RNum FROM '+                                                       000643
   644          'CRUD01TBL AS A Where 1=1) as Tbl Where RNum '+                                                             000644
   645          'BetWeen '+%char(Previnitialpos)+' and '+%char(PrevFinalpos) +                                              000645
   646          ' '+%trim(w_Wheresfl);                                                                                      000646
   647                                                                                                                      000647
   648   exec sql                                                                                                           000648
   649     PREPARE QRY FROM: sqlcustomized;                                                                                 000649
   650                                                                                                                      000650
   651   exec sql                                                                                                           000651
   652     DECLARE QRYC CURSOR FOR QRY;                                                                                     000652
   653                                                                                                                      000653
   654   exec sql                                                                                                           000654
   655     OPEN QRYC;                                                                                                       000655
   656                                                                                                                      000656
   657   exec sql                                                                                                           000657
   658     FETCH QRYC INTO:w_Total;                                                                                         000658
   659                                                                                                                      000659
   660   exec sql                                                                                                           000660
   661     CLOSE QRYC;                                                                                                      000661
   662                                                                                                                      000662
   663   Return w_Total;                                                                                                    000663
   664 end-proc;                                                                                                            000664
   665                                                                                                                      000665
   666                                                                                                                      000666
   667                                                                                                                      000667
   668                                                                                                                      000668
   669                                                                                                                      000669
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     14
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   670                                                                                                                      000670
   671                                                                                                                      000671
   672                                                                                                                      000672
   673 // --------------------------------------------------------------------------                                        000673
   674 // run the CRUD                                                                                                      000674
   675 // --------------------------------------------------------------------------                                        000675
   676 Dcl-Proc ExecuteCrudScreen;                                                                                          000676
   677   Dcl-Pi ExecuteCrudScreen;                                                                                          000677
   678     p_choice char(1);                                                                                                000678
   679   end-pi;                                                                                                            000679
   680                                                                                                                      000680
   681   If (p_choice = 'I'); // Insert Screen                                                                              000681
   682     InsertScreen(p_choice);                                                                                          000682
   683   EndIf;                                                                                                             000683
   684                                                                                                                      000684
   685   If (p_choice = 'M'); // Modify Screen                                                                              000685
   686     ModifyScreen(p_choice);                                                                                          000686
   687   EndIf;                                                                                                             000687
   688                                                                                                                      000688
   689   If (p_choice = 'D'); // Delete Screen                                                                              000689
   690     DeleteScreen(p_choice);                                                                                          000690
   691   EndIf;                                                                                                             000691
   692                                                                                                                      000692
   693   If (p_choice = 'V'); // View Screen                                                                                000693
   694     ViewScreen(p_choice);                                                                                            000694
   695   EndIf;                                                                                                             000695
   696 end-proc;                                                                                                            000696
   697                                                                                                                      000697
   698                                                                                                                      000698
   699                                                                                                                      000699
   700                                                                                                                      000700
   701                                                                                                                      000701
   702                                                                                                                      000702
   703                                                                                                                      000703
   704 // --------------------------------------------------------------------------                                        000704
   705 // write the screen                                                                                                  000705
   706 // --------------------------------------------------------------------------                                        000706
   707 Dcl-Proc InsertScreen;                                                                                               000707
   708   Dcl-Pi InsertScreen;                                                                                               000708
   709     p_choice char(1);                                                                                                000709
   710   end-pi;                                                                                                            000710
   711                                                                                                                      000711
   712   Dcl-S choice char(1);                                                                                              000712
   713                                                                                                                      000713
   714   WriteScreen(p_choice);                                                                                             000714
   715                                                                                                                      000715
   716   dow (not pfkey(03));                                                                                               000716
   717     ProtectFields_35 = *Off;                                                                                         000717
   718     ProtectFields_36 = *Off;                                                                                         000718
   719     exfmt CRUDTASK;                                                                                                  000719
   720     Select;                                                                                                          000720
   721       When (pfkey(03));                                                                                              000721
   722         clear CRUDTASK;                                                                                              000722
   723         reset Initialpos;                                                                                            000723
   724         reset Finalpos;                                                                                              000724
   725         pfkey(03) = *Off;                                                                                            000725
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     15
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   726         choice = 'S';                                                                                                000726
   727         ShowScreen(choice);                                                                                          000727
   728         leave;                                                                                                       000728
   729       When (pfkey(10));                                                                                              000729
   730         If (ScreenValidation(p_choice) = *Off);                                                                      000730
   731                                                                                                                      000731
   732           // Executes window confirmation                                                                            000732
   733           choice = 'C';                                                                                              000733
   734           ShowWdw(choice);                                                                                           000734
   735           If (WDWCHOICE = 'Y');                                                                                      000735
   736             LoaddatatoDs();                                                                                          000736
   737                                                                                                                      000737
   738             exec sql                                                                                                 000738
   739             INSERT INTO CRUD01TBL                                                                                    000739
   740               VALUES (:Ds_datacrud);                                                                                 000740
   741                                                                                                                      000741
   742             If (xSQLState = SUCCESS_ON_SQL);                                                                         000742
   743               choice = 'M'; // Message of successful                                                                 000743
   744               ShowWdw(choice);                                                                                       000744
   745               clear CRUDTASK;                                                                                        000745
   746               reset Initialpos;                                                                                      000746
   747               reset Finalpos;                                                                                        000747
   748               choice = 'S';                                                                                          000748
   749               ShowScreen(choice);                                                                                    000749
   750               leave;                                                                                                 000750
   751             Else;                                                                                                    000751
   752               choice = 'E'; // Error Message                                                                         000752
   753               ShowWdw(choice);                                                                                       000753
   754             EndIf;                                                                                                   000754
   755           Else ;                                                                                                     000755
   756             clear CRUDTASK;                                                                                          000756
   757           EndIf;                                                                                                     000757
   758         EndIf;                                                                                                       000758
   759                                                                                                                      000759
   760       Other;                                                                                                         000760
   761         If (ScreenValidation(p_choice) = *On);                                                                       000761
   762           iter;                                                                                                      000762
   763         EndIf ;                                                                                                      000763
   764     EndSl;                                                                                                           000764
   765   enddo;                                                                                                             000765
   766 end-proc;                                                                                                            000766
   767                                                                                                                      000767
   768                                                                                                                      000768
   769                                                                                                                      000769
   770 // --------------------------------------------------------------------------                                        000770
   771 // modify screen                                                                                                     000771
   772 // --------------------------------------------------------------------------                                        000772
   773 Dcl-Proc ModifyScreen;                                                                                               000773
   774   Dcl-Pi ModifyScreen;                                                                                               000774
   775     p_choice char(1);                                                                                                000775
   776   end-pi;                                                                                                            000776
   777                                                                                                                      000777
   778   Dcl-S choice char(1);                                                                                              000778
   779                                                                                                                      000779
   780   LoaddatatoScreen();                                                                                                000780
   781   WriteScreen(p_choice);                                                                                             000781
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     16
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   782                                                                                                                      000782
   783   dow (not pfkey(03));                                                                                               000783
   784     ProtectFields_35 = *On;                                                                                          000784
   785     exfmt CRUDTASK;                                                                                                  000785
   786     Select;                                                                                                          000786
   787       When (pfkey(03));                                                                                              000787
   788         ProtectFields_35 = *Off;                                                                                     000788
   789         clear CRUDTASK;                                                                                              000789
   790         clear OPCTASK;                                                                                               000790
   791         pfkey(03) = *Off;                                                                                            000791
   792         w_Crudfinalize = *On ;                                                                                       000792
   793         reset Initialpos;                                                                                            000793
   794         reset Finalpos;                                                                                              000794
   795         choice = 'S';                                                                                                000795
   796         ShowScreen(choice);                                                                                          000796
   797         leave;                                                                                                       000797
   798       When (pfkey(10));                                                                                              000798
   799         If (ScreenValidation(p_choice) = *Off);                                                                      000799
   800                                                                                                                      000800
   801           // Executes window confirmation                                                                            000801
   802           choice = 'C';                                                                                              000802
   803           ShowWdw(choice);                                                                                           000803
   804           If (WDWCHOICE = 'Y');                                                                                      000804
   805                                                                                                                      000805
   806             exec sql                                                                                                 000806
   807             UPDATE CRUD01TBL                                                                                         000807
   808               SET NAME = :NAMETASK,                                                                                  000808
   809                   DESCR = :DESCRP,                                                                                   000809
   810                   ENDDES = :SOLUTION,                                                                                000810
   811                   STARTDATE = :STARTDATE,                                                                            000811
   812                   ENDDATE = :ENDDATE,                                                                                000812
   813                   STATE = :STATETASK,                                                                                000813
   814                   OWNER = :CurrentUser                                                                               000814
   815               WHERE TASK_ID = : CRUDTASKID;                                                                          000815
   816                                                                                                                      000816
   817             If (xSQLState = SUCCESS_ON_SQL);                                                                         000817
   818               choice = 'M'; // Message of successful                                                                 000818
   819               ShowWdw(choice);                                                                                       000819
   820               clear CRUDTASK;                                                                                        000820
   821               clear OPCTASK;                                                                                         000821
   822               reset Initialpos;                                                                                      000822
   823               reset Finalpos;                                                                                        000823
   824               choice = 'S';                                                                                          000824
   825               ShowScreen(choice);                                                                                    000825
   826               w_Crudfinalize = *On ;                                                                                 000826
   827               leave;                                                                                                 000827
   828             Else;                                                                                                    000828
   829               choice = 'E'; // Error Message                                                                         000829
   830               ShowWdw(choice);                                                                                       000830
   831             EndIf;                                                                                                   000831
   832           Else ;                                                                                                     000832
   833             clear CRUDTASK;                                                                                          000833
   834           EndIf;                                                                                                     000834
   835         EndIf;                                                                                                       000835
   836                                                                                                                      000836
   837       Other;                                                                                                         000837
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     17
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   838         If (ScreenValidation(p_choice) = *On);                                                                       000838
   839           iter;                                                                                                      000839
   840         EndIf ;                                                                                                      000840
   841     EndSl;                                                                                                           000841
   842   enddo;                                                                                                             000842
   843 end-proc;                                                                                                            000843
   844                                                                                                                      000844
   845                                                                                                                      000845
   846                                                                                                                      000846
   847                                                                                                                      000847
   848                                                                                                                      000848
   849                                                                                                                      000849
   850                                                                                                                      000850
   851                                                                                                                      000851
   852 // --------------------------------------------------------------------------                                        000852
   853 // delete screen                                                                                                     000853
   854 // --------------------------------------------------------------------------                                        000854
   855 Dcl-Proc DeleteScreen;                                                                                               000855
   856   Dcl-Pi DeleteScreen;                                                                                               000856
   857     p_choice char(1);                                                                                                000857
   858   end-pi;                                                                                                            000858
   859                                                                                                                      000859
   860   Dcl-S choice char(1);                                                                                              000860
   861                                                                                                                      000861
   862   LoaddatatoScreen();                                                                                                000862
   863   WriteScreen(p_choice);                                                                                             000863
   864                                                                                                                      000864
   865   dow (not pfkey(03));                                                                                               000865
   866     ProtectFields_35 = *On;                                                                                          000866
   867     ProtectFields_36 = *On;                                                                                          000867
   868     exfmt CRUDTASK;                                                                                                  000868
   869     Select;                                                                                                          000869
   870       When (pfkey(03));                                                                                              000870
   871         ProtectFields_35 = *Off;                                                                                     000871
   872         ProtectFields_36 = *Off;                                                                                     000872
   873         clear CRUDTASK;                                                                                              000873
   874         clear OPCTASK;                                                                                               000874
   875         pfkey(03) = *Off;                                                                                            000875
   876         w_Crudfinalize = *On ;                                                                                       000876
   877         reset Initialpos;                                                                                            000877
   878         reset Finalpos;                                                                                              000878
   879         choice = 'S';                                                                                                000879
   880         ShowScreen(choice);                                                                                          000880
   881         leave;                                                                                                       000881
   882       When (pfkey(10));                                                                                              000882
   883         If (ScreenValidation(p_choice) = *Off);                                                                      000883
   884                                                                                                                      000884
   885           // Executes window confirmation                                                                            000885
   886           choice = 'C';                                                                                              000886
   887           ShowWdw(choice);                                                                                           000887
   888           If (WDWCHOICE = 'Y');                                                                                      000888
   889                                                                                                                      000889
   890             exec sql                                                                                                 000890
   891             DELETE FROM CRUD01TBL WHERE TASK_ID = : CRUDTASKID;                                                      000891
   892                                                                                                                      000892
   893             If (xSQLState = SUCCESS_ON_SQL);                                                                         000893
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     18
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   894               ShowWdw(p_choice);                                                                                     000894
   895               clear CRUDTASK;                                                                                        000895
   896               clear OPCTASK;                                                                                         000896
   897               reset Initialpos;                                                                                      000897
   898               reset Finalpos;                                                                                        000898
   899               choice = 'S';                                                                                          000899
   900               ShowScreen(choice);                                                                                    000900
   901               w_Crudfinalize = *On ;                                                                                 000901
   902               leave;                                                                                                 000902
   903             Else;                                                                                                    000903
   904               choice = 'E'; // Error Message                                                                         000904
   905               ShowWdw(choice);                                                                                       000905
   906             EndIf;                                                                                                   000906
   907           Else ;                                                                                                     000907
   908             clear CRUDTASK;                                                                                          000908
   909           EndIf;                                                                                                     000909
   910         EndIf;                                                                                                       000910
   911                                                                                                                      000911
   912       Other;                                                                                                         000912
   913         If (ScreenValidation(p_choice) = *On);                                                                       000913
   914           iter;                                                                                                      000914
   915         EndIf ;                                                                                                      000915
   916     EndSl;                                                                                                           000916
   917   enddo;                                                                                                             000917
   918 end-proc;                                                                                                            000918
   919                                                                                                                      000919
   920                                                                                                                      000920
   921                                                                                                                      000921
   922                                                                                                                      000922
   923                                                                                                                      000923
   924                                                                                                                      000924
   925                                                                                                                      000925
   926 // --------------------------------------------------------------------------                                        000926
   927 // view the screen                                                                                                   000927
   928 // --------------------------------------------------------------------------                                        000928
   929 Dcl-Proc ViewScreen;                                                                                                 000929
   930   Dcl-Pi ViewScreen;                                                                                                 000930
   931     p_choice char(1);                                                                                                000931
   932   end-pi;                                                                                                            000932
   933                                                                                                                      000933
   934   Dcl-S choice char(1);                                                                                              000934
   935                                                                                                                      000935
   936   LoaddatatoScreen();                                                                                                000936
   937   WriteScreen(p_choice);                                                                                             000937
   938                                                                                                                      000938
   939   dow (not pfkey(03));                                                                                               000939
   940     ProtectFields_35 = *On;                                                                                          000940
   941     ProtectFields_36 = *On;                                                                                          000941
   942     exfmt CRUDTASK;                                                                                                  000942
   943     If (pfkey(03));                                                                                                  000943
   944       ProtectFields_35 = *Off;                                                                                       000944
   945       ProtectFields_36 = *Off;                                                                                       000945
   946       clear CRUDTASK;                                                                                                000946
   947       clear OPCTASK;                                                                                                 000947
   948       pfkey(03) = *Off;                                                                                              000948
   949       w_Crudfinalize = *On ;                                                                                         000949
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     19
Line   <---------------------- Source Specifications ----------------------------------------------------->  Do  Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10  Num Date   Id  Number
   950       reset Initialpos;                                                                                              000950
   951       reset Finalpos;                                                                                                000951
   952       choice = 'S';                                                                                                  000952
   953       ShowScreen(choice);                                                                                            000953
   954       leave;                                                                                                         000954
   955     EndIf;                                                                                                           000955
   956   enddo;                                                                                                             000956
   957 end-proc;                                                                                                            000957
   958                                                                                                                      000958
   959                                                                                                                      000959
   960                                                                                                                      000960
   961                                                                                                                      000961
   962                                                                                                                      000962
   963                                                                                                                      000963
   964                                                                                                                      000964
   965                                                                                                                      000965
   966 // --------------------------------------------------------------------------                                        000966
   967 // load screen data                                                                                                  000967
   968 // --------------------------------------------------------------------------                                        000968
   969 Dcl-Proc LoaddatatoScreen;                                                                                           000969
   970   clear CRUDTASK;                                                                                                    000970
   971   CRUDTASKID = Ds_datacrud.Task_id;                                                                                  000971
   972   NAMETASK = Ds_datacrud.Name;                                                                                       000972
   973   DESCRP = Ds_datacrud.Descr;                                                                                        000973
   974   SOLUTION = Ds_datacrud.Enddes;                                                                                     000974
   975   STARTDATE = Ds_datacrud.Startdate;                                                                                 000975
   976   ENDDATE = Ds_datacrud.Enddate;                                                                                     000976
   977   STATETASK = Ds_datacrud.State;                                                                                     000977
   978 end-proc ;                                                                                                           000978
   979                                                                                                                      000979
   980                                                                                                                      000980
   981                                                                                                                      000981
   982                                                                                                                      000982
   983                                                                                                                      000983
   984                                                                                                                      000984
   985                                                                                                                      000985
   986                                                                                                                      000986
   987                                                                                                                      000987
   988 // --------------------------------------------------------------------------                                        000988
   989 // load data to data structure                                                                                       000989
   990 // --------------------------------------------------------------------------                                        000990
   991 Dcl-Proc LoaddatatoDs;                                                                                               000991
   992   clear Ds_datacrud;                                                                                                 000992
   993   Ds_datacrud.Task_id = CRUDTASKID;                                                                                  000993
   994   Ds_datacrud.Name = %trim(NAMETASK);                                                                                000994
   995   Ds_datacrud.Descr = %trim(DESCRP);                                                                                 000995
   996   Ds_datacrud.Enddes = %trim(SOLUTION);                                                                              000996
   997   Ds_datacrud.Startdate = STARTDATE;                                                                                 000997
   998   Ds_datacrud.Enddate = ENDDATE;                                                                                     000998
   999   Ds_datacrud.State = STATETASK;                                                                                     000999
  1000   Ds_datacrud.Owner = CurrentUser;                                                                                   001000
  1001 end-proc;                                                                                                            001001
       * * * * *   E N D   O F   S O U R C E   * * * * *
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     20
Line   <---------------------- Data Records -------------------------------------------------------------->      Change Src Seq
Number ....+....1....+....2....+....3....+....4....+....5....+....6....+....7....+....8....+....9....+...10      Date   Id  Number
                       C o m p i l e   T i m e   D a t a
    * * * * *   E N D   O F   C O M P I L E   T I M E   D A T A   * * * * *
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     21
                          M e s s a g e   S u m m a r y
 Msg id  Sv Number Message text
       * * * * *   E N D   O F   M E S S A G E   S U M M A R Y   * * * * *
 5770WDS V7R5M0  220415 RN        IBM ILE RPG             NLITTEN1/CRUD01RPG       PROJEX     25-04-11 10:38:41        Page     22
                            F i n a l   S u m m a r y
  Message Totals:
    Information  (00) . . . . . . . :        0
    Warning      (10) . . . . . . . :        0
    Error        (20) . . . . . . . :        0
    Severe Error (30+)  . . . . . . :        0
    ---------------------------------  -------
    Total . . . . . . . . . . . . . :        0
  Source Totals:
    Records . . . . . . . . . . . . :     1001
    Specifications  . . . . . . . . :      566
    Data records  . . . . . . . . . :        0
    Comments  . . . . . . . . . . . :      392
         * * * * *   E N D   O F   F I N A L   S U M M A R Y   * * * * *
Diagnostic check of source is complete. Highest severity is 00.
          * * * * *   E N D   O F   C O M P I L A T I O N   * * * * *
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     1
Source type...............RPG
Object name...............NLITTEN1/CRUD01RPG
Source file...............QTEMP/QSQLPRE
Member....................*OBJ
To source file............QTEMP/QSQLTEMP1
Options...................*LSTDBG
RPG preprocessor options..*LVL2
Listing option............*PRINT
Target release............V7R4M0
INCLUDE file..............*LIBL/QRPGLESRC
Commit....................*NONE
Allow copy of data........*OPTIMIZE
Close SQL cursor..........*ENDACTGRP
Allow blocking............*ALLREAD
Delay PREPARE.............*NO
Concurrent access
  resolution..............*DFT
Generation level..........10
Printer file..............*LIBL/QSYSPRT
Date format...............*JOB
Date separator............*JOB
Time format...............*HMS
Time separator ...........*JOB
Replace...................*YES
Relational database.......*LOCAL
User .....................*CURRENT
RDB connect method........*DUW
Default collection........*NONE
Dynamic default
  collection..............*NO
Package name..............*OBJLIB/*OBJ
Path......................*NAMING
SQL rules.................*DB2
Created object type.......*PGM
Debugging view............*SOURCE
Debugging encryption key..*NONE
User profile .............*NAMING
Dynamic user profile......*USER
Sort sequence.............*JOB
Language ID...............*JOB
IBM SQL flagging..........*NOFLAG
ANS flagging..............*NONE
Text......................Change Read Update Delete Example
Source file CCSID.........37
Job CCSID.................37
Decimal result options:
  Maximum precision.......31
  Maximum scale...........31
  Minimum divide scale....0
DECFLOAT rounding mode....*HALFEVEN
Compiler options..........TGTCCSID(*JOB) OPTIMIZE(*FULL) INCDIR('includes')
Source member changed on 25-04-11  10:38:41
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     2
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
    1   **free                                                                                                 000001   25-04-04
    2   // --------------------------------------------------------------------------                          000002   25-04-04
    3   // CRUD for single file, with subfile using SQLRPGLE                                                   000003   25-04-04
    4   // --------------------------------------------------------------------------                          000004   25-04-04
    5                                                                                                          000005   25-04-04
    6   ctl-opt copyright('| CRUD01RPG 2018.09.27')                                                            000006   25-04-04
    7    main(mainline);                                                                                       000007   25-04-04
    8                                                                                                          000008   25-04-04
    9   dcl-f CRUD01PNL workstn sfile(SFLTASK:taskrrn) usropn infds(infds);                                    000009   25-04-04
   10                                                                                                          000010   25-04-04
   11   // Validation indicators                                                                               000011   25-04-04
   12   Dcl-S pIndicators Pointer Inz(%Addr(*In));                                                             000012   25-04-04
   13   Dcl-Ds DspInd Based(pIndicators);                                                                      000013   25-04-04
   14     // Subfile indicators                                                                                000014   25-04-04
   15     SflDsp          Ind Pos(99);                                                                         000015   25-04-04
   16     SflDspCtl       Ind Pos(98);                                                                         000016   25-04-04
   17     SflClr          Ind Pos(97);                                                                         000017   25-04-04
   18     SflEnd          Ind Pos(96);                                                                         000018   25-04-04
   19     // Validation Errors                                                                                 000019   25-04-04
   20     Taskidexisterror_31 Ind Pos(31);                                                                     000020   25-04-04
   21     Startdateerror_32  Ind Pos(32);                                                                      000021   25-04-04
   22     Enddateerror_33 Ind Pos(33);                                                                         000022   25-04-04
   23     Dategreaterthanerror_34 Ind Pos(34);                                                                 000023   25-04-04
   24     ProtectFields_35 Ind Pos(35);                                                                        000024   25-04-04
   25     ProtectFields_36 Ind Pos(36);                                                                        000025   25-04-04
   26     IndErrors char(20) Pos(31);                                                                          000026   25-04-04
   27   end-ds;                                                                                                000027   25-04-04
   28                                                                                                          000028   25-04-04
   29   // Variable Pointer for SQL Errors                                                                     000029   25-04-04
   30   Dcl-S pSqlstate Pointer Inz(%Addr(SQLState));                                                          000030   25-04-04
   31                                                                                                          000031   25-04-04
   32   Dcl-Ds Ds_SqlState based(pSqlstate);                                                                   000032   25-04-04
   33     xSqlstate char(2);                                                                                   000033   25-04-04
   34   end-ds;                                                                                                000034   25-04-04
   35                                                                                                          000035   25-04-04
   36   // Constant error on SQL                                                                               000036   25-04-04
   37   Dcl-C SUCCESS_ON_SQL '00';                                                                             000037   25-04-04
   38   Dcl-C WARNING_ON_SQL '01';                                                                             000038   25-04-04
   39   Dcl-C NODATA_ON_SQL  '02';                                                                             000039   25-04-04
   40                                                                                                          000040   25-04-04
   41   // Data structure based in the query neccesary for fill the subfile of                                 000041   25-04-04
   42   // the file CRUD01TBL                                                                                  000042   25-04-04
   43   Dcl-Ds Ds_taskdata qualified;                                                                          000043   25-04-04
   44     Taskid     zoned(10);                                                                                000044   25-04-04
   45     Nametask    char(20);                                                                                000045   25-04-04
   46     Start_date zoned(8);                                                                                 000046   25-04-04
   47     End_date   zoned(8);                                                                                 000047   25-04-04
   48     Taskstate  zoned(1);                                                                                 000048   25-04-04
   49   end-ds;                                                                                                000049   25-04-04
   50                                                                                                          000050   25-04-04
   51   // Data structure for general use in CRUD operations                                                   000051   25-04-04
   52   Dcl-Ds Ds_datacrud extname('CRUD01TBL') qualified end-ds;                                              000052   25-04-04
   53                                                                                                          000053   25-04-04
   54   // Relative record number for SFLTASK subfile task                                                     000054   25-04-04
   55   Dcl-S taskrrn zoned(3:0);                                                                              000055   25-04-04
   56                                                                                                          000056   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     3
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
   57   // Variables for subfile scroll position                                                               000057   25-04-04
   58   Dcl-S Initialpos zoned(10:0) inz(0);                                                                   000058   25-04-04
   59   Dcl-S Finalpos zoned(10:0) inz(10);                                                                    000059   25-04-04
   60                                                                                                          000060   25-04-04
   61   // Previous initial and finalpos for indicates final                                                   000061   25-04-04
   62   Dcl-S Previnitialpos zoned(10:0);                                                                      000062   25-04-04
   63   Dcl-S PrevFinalpos zoned(10:0) ;                                                                       000063   25-04-04
   64                                                                                                          000064   25-04-04
   65   // Variable for apply filter to subfile query                                                          000065   25-04-04
   66   Dcl-S w_Wheresfl char(500) inz(*blanks);                                                               000066   25-04-04
   67                                                                                                          000067   25-04-04
   68   // Quantity of records per page in subfile change the inz value depend                                 000068   25-04-04
   69   // of your subfile capacity                                                                            000069   25-04-04
   70   Dcl-C PERPAGE 10;                                                                                      000070   25-04-04
   71                                                                                                          000071   25-04-04
   72   // Variable for indicates that crud operations are finalized                                           000072   25-04-04
   73   Dcl-S w_Crudfinalize Ind;                                                                              000073   25-04-04
   74                                                                                                          000074   25-04-04
   75   // Variable with current user                                                                          000075   25-04-04
   76   Dcl-S CurrentUser char(10) inz(*user);                                                                 000076   25-04-04
   77                                                                                                          000077   25-04-04
   78                                                                                                          000078   25-04-04
   79                                                                                                          000079   25-04-04
   80                                                                                                          000080   25-04-04
   81                                                                                                          000081   25-04-04
   82                                                                                                          000082   25-04-04
   83   // --------------------------------------------------------------------------                          000083   25-04-04
   84   // This is the mainline process that is executed when the program is called                            000084   25-04-04
   85   // --------------------------------------------------------------------------                          000085   25-04-04
   86   Dcl-Proc mainline;                                                                                     000086   25-04-04
   87                                                                                                          000087   25-04-04
   88     Dcl-S choice char(1) inz(*blanks);                                                                   000088   25-04-04
   89                                                                                                          000089   25-04-04
   90     open CRUD01PNL;                                                                                      000090   25-04-04
   91                                                                                                          000091   25-04-04
   92     // The value 'S' is for Subfile Menu                                                                 000092   25-04-04
   93     choice = 'S';                                                                                        000093   25-04-04
   94                                                                                                          000094   25-04-04
   95     ShowScreen(choice);                                                                                  000095   25-04-04
   96                                                                                                          000096   25-04-04
   97     // Termination of program                                                                            000097   25-04-04
   98     close CRUD01PNL;                                                                                     000098   25-04-04
   99     *Inlr = *On;                                                                                         000099   25-04-04
  100   end-proc;                                                                                              000100   25-04-04
  101                                                                                                          000101   25-04-04
  102                                                                                                          000102   25-04-04
  103                                                                                                          000103   25-04-04
  104                                                                                                          000104   25-04-04
  105                                                                                                          000105   25-04-04
  106                                                                                                          000106   25-04-04
  107   // --------------------------------------------------------------------------                          000107   25-04-04
  108   // This procedure receives a parameter for the titles that are written                                 000108   25-04-04
  109   // --------------------------------------------------------------------------                          000109   25-04-04
  110   Dcl-Proc WriteScreen;                                                                                  000110   25-04-04
  111     Dcl-Pi WriteScreen;                                                                                  000111   25-04-04
  112       p_choice char(1);                                                                                  000112   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     4
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  113     end-pi;                                                                                              000113   25-04-04
  114                                                                                                          000114   25-04-04
  115     // Secondary titles                                                                                  000115   25-04-04
  116     TITLE2 = Center('Created by Some Bloke':%len(TITLE2));                                               000116   25-04-04
  117     TITLE3 = Center('Back in 2018':%len(TITLE3));                                                        000117   25-04-04
  118                                                                                                          000118   25-04-04
  119     // Principal title                                                                                   000119   25-04-04
  120     Select;                                                                                              000120   25-04-04
  121                                                                                                          000121   25-04-04
  122         // CRUD Options                                                                                  000122   25-04-04
  123       When (p_choice = 'I');                                                                             000123   25-04-04
  124         TITLE1 = Center('TASKS ADMINISTRATOR INSERT':%len(TITLE1));                                      000124   25-04-04
  125       When (p_choice = 'M');                                                                             000125   25-04-04
  126         TITLE1 = Center('TASKS ADMINISTRATOR MODIFY':%len(TITLE1));                                      000126   25-04-04
  127       When (p_choice = 'D');                                                                             000127   25-04-04
  128         TITLE1 = Center('TASKS ADMINISTRATOR DELETE':%len(TITLE1));                                      000128   25-04-04
  129       When (p_choice = 'V');                                                                             000129   25-04-04
  130         TITLE1 = Center('TASKS ADMINISTRATOR VIEW':%len(TITLE1));                                        000130   25-04-04
  131                                                                                                          000131   25-04-04
  132         // Subfile                                                                                       000132   25-04-04
  133       When (p_choice = 'S');                                                                             000133   25-04-04
  134         TITLE1 = Center('TASKS ADMINISTRATOR MAIN MENU':%len(TITLE1));                                   000134   25-04-04
  135     EndSl;                                                                                               000135   25-04-04
  136                                                                                                          000136   25-04-04
  137     // Use an IF/ELSEIF as a different way of doing SELECT groups                                        000137   25-04-04
  138     // here is an example:                                                                               000138   25-04-04
  139     If (p_choice = 'S');                                                                                 000139   25-04-04
  140       FOOTTEXT = 'F3=Exit  F5=Refresh  F6=Create';                                                       000140   25-04-04
  141     elseif (p_choice = 'I' or p_choice= 'M' or p_choice= 'D');                                           000141   25-04-04
  142       FOOTTEXT = 'F3=Exit      F10=Confirm';                                                             000142   25-04-04
  143     elseif (p_choice = 'V');                                                                             000143   25-04-04
  144       FOOTTEXT = 'F3=Exit  ';                                                                            000144   25-04-04
  145     EndIf;                                                                                               000145   25-04-04
  146                                                                                                          000146   25-04-04
  147     write HEADER;                                                                                        000147   25-04-04
  148     write FOOTER;                                                                                        000148   25-04-04
  149   end-proc;                                                                                              000149   25-04-04
  150                                                                                                          000150   25-04-04
  151                                                                                                          000151   25-04-04
  152                                                                                                          000152   25-04-04
  153                                                                                                          000153   25-04-04
  154                                                                                                          000154   25-04-04
  155                                                                                                          000155   25-04-04
  156                                                                                                          000156   25-04-04
  157                                                                                                          000157   25-04-04
  158                                                                                                          000158   25-04-04
  159                                                                                                          000159   25-04-04
  160                                                                                                          000160   25-04-04
  161                                                                                                          000161   25-04-04
  162   // --------------------------------------------------------------------------                          000162   25-04-04
  163   // This procedure executes and show the screen choiced by parameter                                    000163   25-04-04
  164   // --------------------------------------------------------------------------                          000164   25-04-04
  165   Dcl-Proc ShowScreen;                                                                                   000165   25-04-04
  166     Dcl-Pi ShowScreen ;                                                                                  000166   25-04-04
  167       p_choice char(1);                                                                                  000167   25-04-04
  168     end-pi;                                                                                              000168   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     5
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  169                                                                                                          000169   25-04-04
  170     Select;                                                                                              000170   25-04-04
  171       When (p_choice = 'I');                                                                             000171   25-04-04
  172         InsertScreen(p_choice);                                                                          000172   25-04-04
  173       When (p_choice = 'S');                                                                             000173   25-04-04
  174         ShowSubfile(p_choice);                                                                           000174   25-04-04
  175       When (p_choice = 'M');                                                                             000175   25-04-04
  176         ModifyScreen(p_choice);                                                                          000176   25-04-04
  177       When (p_choice = 'D');                                                                             000177   25-04-04
  178         DeleteScreen(p_choice);                                                                          000178   25-04-04
  179       When (p_choice = 'V');                                                                             000179   25-04-04
  180         ViewScreen(p_choice);                                                                            000180   25-04-04
  181     EndSl;                                                                                               000181   25-04-04
  182                                                                                                          000182   25-04-04
  183   end-proc;                                                                                              000183   25-04-04
  184                                                                                                          000184   25-04-04
  185                                                                                                          000185   25-04-04
  186                                                                                                          000186   25-04-04
  187                                                                                                          000187   25-04-04
  188                                                                                                          000188   25-04-04
  189                                                                                                          000189   25-04-04
  190                                                                                                          000190   25-04-04
  191   // --------------------------------------------------------------------------                          000191   25-04-04
  192   // Show Window to user for confirm the current action                                                  000192   25-04-04
  193   // --------------------------------------------------------------------------                          000193   25-04-04
  194   Dcl-Proc ShowWdw;                                                                                      000194   25-04-04
  195     Dcl-Pi ShowWdw;                                                                                      000195   25-04-04
  196       p_choice char(1);                                                                                  000196   25-04-04
  197     end-pi;                                                                                              000197   25-04-04
  198                                                                                                          000198   25-04-04
  199     // 'C' for confirm save record in database                                                           000199   25-04-04
  200     If (p_choice = 'C');                                                                                 000200   25-04-04
  201       WDWTEXT1 = 'Are you sure to execute this action?';                                                 000201   25-04-04
  202       WDWTEXT2 = 'Please type Y/N ';                                                                     000202   25-04-04
  203       write WDWCONFIRM;                                                                                  000203   25-04-04
  204       exfmt WDWCONFIRM;                                                                                  000204   25-04-04
  205     EndIf;                                                                                               000205   25-04-04
  206                                                                                                          000206   25-04-04
  207     // 'M' for message information                                                                       000207   25-04-04
  208     If (p_choice = 'M');                                                                                 000208   25-04-04
  209       WDWMSG1 = 'Your record has been saved';                                                            000209   25-04-04
  210       exfmt WDWMESSAGE;                                                                                  000210   25-04-04
  211     EndIf;                                                                                               000211   25-04-04
  212                                                                                                          000212   25-04-04
  213     If (p_choice = 'D');                                                                                 000213   25-04-04
  214       WDWMSG1 = 'Your record has been deleted';                                                          000214   25-04-04
  215       exfmt WDWMESSAGE;                                                                                  000215   25-04-04
  216     EndIf;                                                                                               000216   25-04-04
  217                                                                                                          000217   25-04-04
  218     // 'E' for error message                                                                             000218   25-04-04
  219     If (p_choice = 'E');                                                                                 000219   25-04-04
  220       WDWMSG1 = 'Error executing this action ';                                                          000220   25-04-04
  221       exfmt WDWMESSAGE;                                                                                  000221   25-04-04
  222     EndIf;                                                                                               000222   25-04-04
  223                                                                                                          000223   25-04-04
  224   end-proc;                                                                                              000224   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     6
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  225                                                                                                          000225   25-04-04
  226                                                                                                          000226   25-04-04
  227                                                                                                          000227   25-04-04
  228                                                                                                          000228   25-04-04
  229                                                                                                          000229   25-04-04
  230                                                                                                          000230   25-04-04
  231                                                                                                          000231   25-04-04
  232                                                                                                          000232   25-04-04
  233                                                                                                          000233   25-04-04
  234                                                                                                          000234   25-04-04
  235                                                                                                          000235   25-04-04
  236   // --------------------------------------------------------------------------                          000236   25-04-04
  237   // This procedure Center the titles of the screen                                                      000237   25-04-04
  238   // --------------------------------------------------------------------------                          000238   25-04-04
  239   Dcl-Proc Center;                                                                                       000239   25-04-04
  240     Dcl-Pi Center char(80);                                                                              000240   25-04-04
  241       Par_Text char(80) value;                                                                           000241   25-04-04
  242       Par_Length zoned(2:0) value;                                                                       000242   25-04-04
  243     end-pi;                                                                                              000243   25-04-04
  244                                                                                                          000244   25-04-04
  245     // Local variables                                                                                   000245   25-04-04
  246     Dcl-S LenBlanks zoned(2:0);                                                                          000246   25-04-04
  247     Dcl-S InitPosition zoned(2:0);                                                                       000247   25-04-04
  248     Dcl-S Centeredtext char(80);                                                                         000248   25-04-04
  249                                                                                                          000249   25-04-04
  250     LenBlanks= Par_Length - %Len(%Trim(Par_Text));                                                       000250   25-04-04
  251     InitPosition = LenBlanks /2;                                                                         000251   25-04-04
  252     %Subst(Centeredtext:InitPosition)= %Trim(Par_Text);                                                  000252   25-04-04
  253     Return Centeredtext;                                                                                 000253   25-04-04
  254                                                                                                          000254   25-04-04
  255   end-proc;                                                                                              000255   25-04-04
  256                                                                                                          000256   25-04-04
  257                                                                                                          000257   25-04-04
  258                                                                                                          000258   25-04-04
  259                                                                                                          000259   25-04-04
  260                                                                                                          000260   25-04-04
  261                                                                                                          000261   25-04-04
  262                                                                                                          000262   25-04-04
  263                                                                                                          000263   25-04-04
  264   // --------------------------------------------------------------------------                          000264   25-04-04
  265   // Show the subfile in the screen                                                                      000265   25-04-04
  266   // --------------------------------------------------------------------------                          000266   25-04-04
  267   Dcl-Proc ShowSubfile;                                                                                  000267   25-04-04
  268     Dcl-Pi ShowSubfile;                                                                                  000268   25-04-04
  269       p_choice char(1);                                                                                  000269   25-04-04
  270     end-pi;                                                                                              000270   25-04-04
  271                                                                                                          000271   25-04-04
  272     Dcl-S w_exist char(1);                                                                               000272   25-04-04
  273     Dcl-S choice char(1);                                                                                000273   25-04-04
  274                                                                                                          000274   25-04-04
  275     dow (not pfkey(03));                                                                                 000275   25-04-04
  276       WriteScreen(p_choice);                                                                             000276   25-04-04
  277       ActivateSubfile();                                                                                 000277   25-04-04
  278       exfmt SFLTASKCTL;                                                                                  000278   25-04-04
  279                                                                                                          000279   25-04-04
  280       Select ;                                                                                           000280   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     7
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  281         When (pfkey(03));                                                                                000281   25-04-04
  282           pfkey(03) = *Off;                                                                              000282   25-04-04
  283           reset Initialpos;                                                                              000283   25-04-04
  284           reset Finalpos;                                                                                000284   25-04-04
  285           leave;                                                                                         000285   25-04-04
  286         When (infds.funcKey = Pageup);                                                                   000286   25-04-04
  287           If (Initialpos = 0 and Finalpos = 10);                                                         000287   25-04-04
  288             iter;                                                                                        000288   25-04-04
  289           elseif (Initialpos > 1 and Finalpos > 10);                                                     000289   25-04-04
  290             Initialpos -= 11;                                                                            000290   25-04-04
  291             Finalpos -= 10;                                                                              000291   25-04-04
  292             ShowScreen(p_choice);                                                                        000292   25-04-04
  293             leave;                                                                                       000293   25-04-04
  294           EndIf;                                                                                         000294   25-04-04
  295                                                                                                          000295   25-04-04
  296         When (infds.funcKey = PageDn);                                                                   000296   25-04-04
  297                                                                                                          000297   25-04-04
  298           If (Initialpos > 0 and Finalpos > 10);                                                         000298   25-04-04
  299                                                                                                          000299   25-04-04
  300             exec sql                                                                                     000300   25-04-04
  301             SELECT '1'                                                                                   000301   25-04-04
  302               INTO : w_exist                                                                             000302   25-04-04
  303               FROM (SELECT A.*,                                                                          000303   25-04-04
  304                            RowNumber()                                                                   000304   25-04-04
  305                       Over()                                                                             000305   25-04-04
  306                       as RNum                                                                            000306   25-04-04
  307                       FROM CRUD01TBL AS A                                                                000307   25-04-04
  308                       Where 1 = 1)                                                                       000308   25-04-04
  309               as Tbl                                                                                     000309   25-04-04
  310               Where RNum BetWeen : Initialpos AND                                                        000310   25-04-04
  311                     :Finalpos                                                                            000311   25-04-04
  312               FETCH FIRST ROW ONLY;                                                                      000312   25-04-04
  313                                                                                                          000313   25-04-04
  314             If (w_exist <> '1');                                                                         000314   25-04-04
  315               Initialpos -= 11;                                                                          000315   25-04-04
  316               Finalpos -= 10;                                                                            000316   25-04-04
  317             EndIf;                                                                                       000317   25-04-04
  318                                                                                                          000318   25-04-04
  319             ShowScreen(p_choice);                                                                        000319   25-04-04
  320             leave;                                                                                       000320   25-04-04
  321                                                                                                          000321   25-04-04
  322           Else;                                                                                          000322   25-04-04
  323             ShowScreen(p_choice);                                                                        000323   25-04-04
  324             leave;                                                                                       000324   25-04-04
  325           EndIf;                                                                                         000325   25-04-04
  326                                                                                                          000326   25-04-04
  327         When (pfkey(05));                                                                                000327   25-04-04
  328                                                                                                          000328   25-04-04
  329           reset Initialpos;                                                                              000329   25-04-04
  330           reset Finalpos;                                                                                000330   25-04-04
  331                                                                                                          000331   25-04-04
  332           ShowScreen(p_choice);                                                                          000332   25-04-04
  333           leave;                                                                                         000333   25-04-04
  334         When (pfkey(06));                                                                                000334   25-04-04
  335           choice = 'I';                                                                                  000335   25-04-04
  336           ShowScreen(choice);                                                                            000336   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     8
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  337           leave;                                                                                         000337   25-04-04
  338         Other;                                                                                           000338   25-04-04
  339           reset w_Wheresfl;                                                                              000339   25-04-04
  340                                                                                                          000340   25-04-04
  341           // if there are selected records in subfile then executes                                      000341   25-04-04
  342           If (taskrrn > *zeros);                                                                         000342   25-04-04
  343             for taskrrn = 1 to PERPAGE;                                                                  000343   25-04-04
  344               chain taskrrn SFLTASK;                                                                     000344   25-04-04
  345               If (%found());                                                                             000345   25-04-04
  346                                                                                                          000346   25-04-04
  347                 Select;                                                                                  000347   25-04-04
  348                   When (OPCTASK = '2');                                                                  000348   25-04-04
  349                                                                                                          000349   25-04-04
  350                     clear Ds_datacrud;                                                                   000350   25-04-04
  351                                                                                                          000351   25-04-04
  352                     // Loads the data into data structure                                                000352   25-04-04
  353                     exec sql                                                                             000353   25-04-04
  354                   SELECT * INTO:Ds_datacrud                                                              000354   25-04-04
  355                     FROM CRUD01TBL                                                                       000355   25-04-04
  356                     WHERE TASK_ID = : SFLTASKID;                                                         000356   25-04-04
  357                                                                                                          000357   25-04-04
  358                     choice = 'M';                                                                        000358   25-04-04
  359                     ShowScreen(choice);                                                                  000359   25-04-04
  360                     leave;                                                                               000360   25-04-04
  361                   When (OPCTASK = '4');                                                                  000361   25-04-04
  362                     clear Ds_datacrud;                                                                   000362   25-04-04
  363                                                                                                          000363   25-04-04
  364                     // Loads the data into data structure                                                000364   25-04-04
  365                     exec sql                                                                             000365   25-04-04
  366                   SELECT * INTO:Ds_datacrud                                                              000366   25-04-04
  367                     FROM CRUD01TBL                                                                       000367   25-04-04
  368                     WHERE TASK_ID = : SFLTASKID;                                                         000368   25-04-04
  369                                                                                                          000369   25-04-04
  370                     choice = 'D';                                                                        000370   25-04-04
  371                     ShowScreen(choice);                                                                  000371   25-04-04
  372                     leave;                                                                               000372   25-04-04
  373                   When (OPCTASK = '5');                                                                  000373   25-04-04
  374                     clear Ds_datacrud;                                                                   000374   25-04-04
  375                                                                                                          000375   25-04-04
  376                     // Loads the data into data structure                                                000376   25-04-04
  377                     exec sql                                                                             000377   25-04-04
  378                   SELECT * INTO:Ds_datacrud                                                              000378   25-04-04
  379                     FROM CRUD01TBL                                                                       000379   25-04-04
  380                     WHERE TASK_ID = : SFLTASKID;                                                         000380   25-04-04
  381                                                                                                          000381   25-04-04
  382                     choice = 'V';                                                                        000382   25-04-04
  383                     ShowScreen(choice);                                                                  000383   25-04-04
  384                     leave;                                                                               000384   25-04-04
  385                 EndSl;                                                                                   000385   25-04-04
  386                 // Clean the field                                                                       000386   25-04-04
  387                 OPCTASK = *Blanks;                                                                       000387   25-04-04
  388                 Update SFLTASK;                                                                          000388   25-04-04
  389               Else;                                                                                      000389   25-04-04
  390                 leave;                                                                                   000390   25-04-04
  391               EndIf;                                                                                     000391   25-04-04
  392             endfor;                                                                                      000392   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page     9
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  393           EndIf;                                                                                         000393   25-04-04
  394       EndSl;                                                                                             000394   25-04-04
  395       If (w_Crudfinalize = *On);                                                                         000395   25-04-04
  396         w_Crudfinalize = *Off;                                                                           000396   25-04-04
  397         leave;                                                                                           000397   25-04-04
  398       EndIf;                                                                                             000398   25-04-04
  399                                                                                                          000399   25-04-04
  400     enddo;                                                                                               000400   25-04-04
  401                                                                                                          000401   25-04-04
  402   end-proc ;                                                                                             000402   25-04-04
  403                                                                                                          000403   25-04-04
  404                                                                                                          000404   25-04-04
  405                                                                                                          000405   25-04-04
  406                                                                                                          000406   25-04-04
  407                                                                                                          000407   25-04-04
  408                                                                                                          000408   25-04-04
  409                                                                                                          000409   25-04-04
  410   // --------------------------------------------------------------------------                          000410   25-04-04
  411   // handle all screen validation                                                                        000411   25-04-04
  412   // --------------------------------------------------------------------------                          000412   25-04-04
  413   Dcl-Proc ScreenValidation ;                                                                            000413   25-04-04
  414     Dcl-Pi ScreenValidation Ind;                                                                         000414   25-04-04
  415       p_choice char(1);                                                                                  000415   25-04-04
  416     end-pi;                                                                                              000416   25-04-04
  417                                                                                                          000417   25-04-04
  418     Dcl-S w_ValidisnotOK Ind;                                                                            000418   25-04-04
  419     Dcl-S w_Exists char(1);                                                                              000419   25-04-04
  420                                                                                                          000420   25-04-04
  421     // Set zeros in general variable based in DspInd                                                     000421   25-04-04
  422     IndErrors = *zeros;                                                                                  000422   25-04-04
  423                                                                                                          000423   25-04-04
  424     If (p_choice = 'I'); // Validations for Insert                                                       000424   25-04-04
  425                                                                                                          000425   25-04-04
  426       TurnoffErrors();                                                                                   000426   25-04-04
  427                                                                                                          000427   25-04-04
  428       // Search Task id entered into database                                                            000428   25-04-04
  429       exec sql                                                                                           000429   25-04-04
  430         SELECT '1'                                                                                       000430   25-04-04
  431           INTO : w_Exists                                                                                000431   25-04-04
  432           FROM CRUD01TBL                                                                                 000432   25-04-04
  433           WHERE TASK_ID = :CRUDTASKID;                                                                   000433   25-04-04
  434                                                                                                          000434   25-04-04
  435       Taskidexisterror_31 = (w_Exists = '1');                                                            000435   25-04-04
  436                                                                                                          000436   25-04-04
  437       // Validation of dates                                                                             000437   25-04-04
  438       test(De) *iso STARTDATE; //Validates if date is in YYYYMMDD                                        000438   25-04-04
  439                                                                                                          000439   25-04-04
  440       Startdateerror_32 = %error;                                                                        000440   25-04-04
  441                                                                                                          000441   25-04-04
  442       test(De) *iso ENDDATE;                                                                             000442   25-04-04
  443                                                                                                          000443   25-04-04
  444       Enddateerror_33 = %error;                                                                          000444   25-04-04
  445                                                                                                          000445   25-04-04
  446       If (STARTDATE <> *zeros and ENDDATE <> *zeros                                                      000446   25-04-04
  447           and Startdateerror_32 = *Off and Enddateerror_33 = *Off);                                      000447   25-04-04
  448         If (STARTDATE > ENDDATE);                                                                        000448   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    10
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  449           Dategreaterthanerror_34 = *On;                                                                 000449   25-04-04
  450         EndIf;                                                                                           000450   25-04-04
  451       EndIf;                                                                                             000451   25-04-04
  452     EndIf;                                                                                               000452   25-04-04
  453                                                                                                          000453   25-04-04
  454     w_ValidisnotOK = IndErrors <> *Zeros;                                                                000454   25-04-04
  455                                                                                                          000455   25-04-04
  456     Return w_ValidisnotOK;                                                                               000456   25-04-04
  457   end-proc;                                                                                              000457   25-04-04
  458                                                                                                          000458   25-04-04
  459                                                                                                          000459   25-04-04
  460                                                                                                          000460   25-04-04
  461                                                                                                          000461   25-04-04
  462                                                                                                          000462   25-04-04
  463                                                                                                          000463   25-04-04
  464   // --------------------------------------------------------------------------                          000464   25-04-04
  465   // reset errors                                                                                        000465   25-04-04
  466   // --------------------------------------------------------------------------                          000466   25-04-04
  467   Dcl-Proc TurnoffErrors;                                                                                000467   25-04-04
  468     Taskidexisterror_31 = *Off;                                                                          000468   25-04-04
  469     Startdateerror_32 = *Off;                                                                            000469   25-04-04
  470     Enddateerror_33 = *Off;                                                                              000470   25-04-04
  471     Dategreaterthanerror_34 = *Off;                                                                      000471   25-04-04
  472   end-proc ;                                                                                             000472   25-04-04
  473                                                                                                          000473   25-04-04
  474                                                                                                          000474   25-04-04
  475                                                                                                          000475   25-04-04
  476                                                                                                          000476   25-04-04
  477                                                                                                          000477   25-04-04
  478   // --------------------------------------------------------------------------                          000478   25-04-04
  479   // This procedure set the sql variable to the procedure to                                             000479   25-04-04
  480   // populate the subfile with data based in the customized                                              000480   25-04-04
  481   // sql variable                                                                                        000481   25-04-04
  482   // --------------------------------------------------------------------------                          000482   25-04-04
  483   Dcl-Proc SubfileStart;                                                                                 000483   25-04-04
  484     Dcl-Pi SubfileStart;                                                                                 000484   25-04-04
  485     end-pi;                                                                                              000485   25-04-04
  486                                                                                                          000486   25-04-04
  487     // Variable for store the sql query required                                                         000487   25-04-04
  488     Dcl-S sqlcustomized char(500);                                                                       000488   25-04-04
  489                                                                                                          000489   25-04-04
  490     sqlcustomized = 'SELECT TASK_ID , NAME , STARTDATE , ENDDATE , STATE '+                              000490   25-04-04
  491                     'FROM (SELECT A.*, RowNumber() Over() as RNum FROM '+                                000491   25-04-04
  492                     'CRUD01TBL AS A Where 1=1) as Tbl Where RNum '+                                      000492   25-04-04
  493                     'BetWeen '+%char(Initialpos)+' and '+%char(Finalpos) +                               000493   25-04-04
  494                     ' '+%trim(w_Wheresfl);                                                               000494   25-04-04
  495                                                                                                          000495   25-04-04
  496     FillSfl(sqlcustomized);                                                                              000496   25-04-04
  497                                                                                                          000497   25-04-04
  498   end-proc;                                                                                              000498   25-04-04
  499                                                                                                          000499   25-04-04
  500                                                                                                          000500   25-04-04
  501                                                                                                          000501   25-04-04
  502                                                                                                          000502   25-04-04
  503                                                                                                          000503   25-04-04
  504   // --------------------------------------------------------------------------                          000504   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    11
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  505   // Initialize and prepare the subfile                                                                  000505   25-04-04
  506   // --------------------------------------------------------------------------                          000506   25-04-04
  507   Dcl-Proc Sflinitial;                                                                                   000507   25-04-04
  508     SflEnd = *off;                                                                                       000508   25-04-04
  509     SflClr = *on;                                                                                        000509   25-04-04
  510     write SFLTASKCTL;                                                                                    000510   25-04-04
  511     SflClr = *off;                                                                                       000511   25-04-04
  512     taskrrn = *zeros;                                                                                    000512   25-04-04
  513     SflDsp = *off;                                                                                       000513   25-04-04
  514     SflDspCtl = *off;                                                                                    000514   25-04-04
  515   end-proc;                                                                                              000515   25-04-04
  516                                                                                                          000516   25-04-04
  517                                                                                                          000517   25-04-04
  518                                                                                                          000518   25-04-04
  519                                                                                                          000519   25-04-04
  520                                                                                                          000520   25-04-04
  521                                                                                                          000521   25-04-04
  522                                                                                                          000522   25-04-04
  523   // --------------------------------------------------------------------------                          000523   25-04-04
  524   // Activate the subfile for being displayed on screen                                                  000524   25-04-04
  525   // --------------------------------------------------------------------------                          000525   25-04-04
  526   Dcl-Proc ActivateSubfile;                                                                              000526   25-04-04
  527     Sflinitial();                                                                                        000527   25-04-04
  528     SubfileStart();                                                                                      000528   25-04-04
  529                                                                                                          000529   25-04-04
  530     SflEnd = Gettotalrecords() < 10;                                                                     000530   25-04-04
  531                                                                                                          000531   25-04-04
  532     If (taskrrn > 0);                                                                                    000532   25-04-04
  533       SflDsp = *On;                                                                                      000533   25-04-04
  534     Else;                                                                                                000534   25-04-04
  535       write EMPTY;                                                                                       000535   25-04-04
  536     EndIf;                                                                                               000536   25-04-04
  537                                                                                                          000537   25-04-04
  538     SflDspCtl = *On;                                                                                     000538   25-04-04
  539   end-proc;                                                                                              000539   25-04-04
  540                                                                                                          000540   25-04-04
  541                                                                                                          000541   25-04-04
  542                                                                                                          000542   25-04-04
  543                                                                                                          000543   25-04-04
  544                                                                                                          000544   25-04-04
  545                                                                                                          000545   25-04-04
  546                                                                                                          000546   25-04-04
  547                                                                                                          000547   25-04-04
  548   // --------------------------------------------------------------------------                          000548   25-04-04
  549   // Fill the subfile with a Cursor                                                                      000549   25-04-04
  550   // --------------------------------------------------------------------------                          000550   25-04-04
  551   Dcl-Proc FillSfl;                                                                                      000551   25-04-04
  552     Dcl-Pi FillSfl;                                                                                      000552   25-04-04
  553       Par_sqlcustomized char(500);                                                                       000553   25-04-04
  554     end-pi;                                                                                              000554   25-04-04
  555                                                                                                          000555   25-04-04
  556     Dcl-S Count zoned(2:0);                                                                              000556   25-04-04
  557                                                                                                          000557   25-04-04
  558     Dcl-S LastRRN zoned(10:0);                                                                           000558   25-04-04
  559                                                                                                          000559   25-04-04
  560     // Set previous values for indicates final of subfile is it is                                       000560   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    12
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  561     // necessary                                                                                         000561   25-04-04
  562     clear Previnitialpos;                                                                                000562   25-04-04
  563     clear PrevFinalpos;                                                                                  000563   25-04-04
  564                                                                                                          000564   25-04-04
  565     Previnitialpos = Initialpos;                                                                         000565   25-04-04
  566     PrevFinalpos = Finalpos;                                                                             000566   25-04-04
  567                                                                                                          000567   25-04-04
  568     clear Ds_taskdata;                                                                                   000568   25-04-04
  569                                                                                                          000569   25-04-04
  570     exec sql                                                                                             000570   25-04-04
  571       PREPARE YOURQUERY FROM : Par_sqlcustomized;                                                        000571   25-04-04
  572                                                                                                          000572   25-04-04
  573     exec sql                                                                                             000573   25-04-04
  574       DECLARE TASK_CURSOR INSENSITIVE SCROLL CURSOR FOR YOURQUERY;                                       000574   25-04-04
  575                                                                                                          000575   25-04-04
  576     exec sql                                                                                             000576   25-04-04
  577       OPEN TASK_CURSOR;                                                                                  000577   25-04-04
  578                                                                                                          000578   25-04-04
  579     exec sql                                                                                             000579   25-04-04
  580       FETCH NEXT FROM TASK_CURSOR INTO : Ds_taskdata;                                                    000580   25-04-04
  581                                                                                                          000581   25-04-04
  582     dow (xSQLState <> NODATA_ON_SQL) and (Count < PERPAGE);                                              000582   25-04-04
  583       Count = Count+1;                                                                                   000583   25-04-04
  584       LastRRN = LastRRN+1;                                                                               000584   25-04-04
  585                                                                                                          000585   25-04-04
  586       If (xSQLState = SUCCESS_ON_SQL);                                                                   000586   25-04-04
  587         DatatoSfl();                                                                                     000587   25-04-04
  588       EndIf;                                                                                             000588   25-04-04
  589                                                                                                          000589   25-04-04
  590       exec sql                                                                                           000590   25-04-04
  591         FETCH NEXT FROM TASK_CURSOR INTO : Ds_taskdata;                                                  000591   25-04-04
  592       If (xSQLState <> SUCCESS_ON_SQL);                                                                  000592   25-04-04
  593         If (taskrrn = 10);                                                                               000593   25-04-04
  594           Initialpos += Count+1;                                                                         000594   25-04-04
  595           Finalpos += LastRRN;                                                                           000595   25-04-04
  596         EndIf;                                                                                           000596   25-04-04
  597       EndIf;                                                                                             000597   25-04-04
  598     enddo;                                                                                               000598   25-04-04
  599                                                                                                          000599   25-04-04
  600     exec sql                                                                                             000600   25-04-04
  601       CLOSE TASK_CURSOR;                                                                                 000601   25-04-04
  602   end-proc;                                                                                              000602   25-04-04
  603                                                                                                          000603   25-04-04
  604                                                                                                          000604   25-04-04
  605                                                                                                          000605   25-04-04
  606                                                                                                          000606   25-04-04
  607                                                                                                          000607   25-04-04
  608                                                                                                          000608   25-04-04
  609                                                                                                          000609   25-04-04
  610   // --------------------------------------------------------------------------                          000610   25-04-04
  611   // This procedure assign the data fetched from cursor to subfile                                       000611   25-04-04
  612   // --------------------------------------------------------------------------                          000612   25-04-04
  613   Dcl-Proc DatatoSfl;                                                                                    000613   25-04-04
  614     taskrrn +=1;                                                                                         000614   25-04-04
  615     SFLTASKID = Ds_taskdata.Taskid;                                                                      000615   25-04-04
  616     SFLTASKNAM = Ds_taskdata.Nametask;                                                                   000616   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    13
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  617     SFLSTRDATE = Ds_taskdata.Start_date;                                                                 000617   25-04-04
  618     SFLENDDATE = Ds_taskdata.End_date;                                                                   000618   25-04-04
  619     SFLSTATE = Ds_taskdata.Taskstate;                                                                    000619   25-04-04
  620     write SFLTASK;                                                                                       000620   25-04-04
  621     clear SFLTASK;                                                                                       000621   25-04-04
  622   end-proc;                                                                                              000622   25-04-04
  623                                                                                                          000623   25-04-04
  624                                                                                                          000624   25-04-04
  625                                                                                                          000625   25-04-04
  626                                                                                                          000626   25-04-04
  627                                                                                                          000627   25-04-04
  628                                                                                                          000628   25-04-04
  629                                                                                                          000629   25-04-04
  630                                                                                                          000630   25-04-04
  631   // --------------------------------------------------------------------------                          000631   25-04-04
  632   // get total records                                                                                   000632   25-04-04
  633   // --------------------------------------------------------------------------                          000633   25-04-04
  634   Dcl-Proc Gettotalrecords;                                                                              000634   25-04-04
  635     Dcl-Pi Gettotalrecords zoned(10);                                                                    000635   25-04-04
  636     end-pi;                                                                                              000636   25-04-04
  637                                                                                                          000637   25-04-04
  638     Dcl-S w_Total zoned(10:0);                                                                           000638   25-04-04
  639                                                                                                          000639   25-04-04
  640     Dcl-S sqlcustomized char(500);                                                                       000640   25-04-04
  641                                                                                                          000641   25-04-04
  642     sqlcustomized = 'SELECT COUNT(*) '+                                                                  000642   25-04-04
  643            'FROM (SELECT A.*, RowNumber() Over() as RNum FROM '+                                         000643   25-04-04
  644            'CRUD01TBL AS A Where 1=1) as Tbl Where RNum '+                                               000644   25-04-04
  645            'BetWeen '+%char(Previnitialpos)+' and '+%char(PrevFinalpos) +                                000645   25-04-04
  646            ' '+%trim(w_Wheresfl);                                                                        000646   25-04-04
  647                                                                                                          000647   25-04-04
  648     exec sql                                                                                             000648   25-04-04
  649       PREPARE QRY FROM: sqlcustomized;                                                                   000649   25-04-04
  650                                                                                                          000650   25-04-04
  651     exec sql                                                                                             000651   25-04-04
  652       DECLARE QRYC CURSOR FOR QRY;                                                                       000652   25-04-04
  653                                                                                                          000653   25-04-04
  654     exec sql                                                                                             000654   25-04-04
  655       OPEN QRYC;                                                                                         000655   25-04-04
  656                                                                                                          000656   25-04-04
  657     exec sql                                                                                             000657   25-04-04
  658       FETCH QRYC INTO:w_Total;                                                                           000658   25-04-04
  659                                                                                                          000659   25-04-04
  660     exec sql                                                                                             000660   25-04-04
  661       CLOSE QRYC;                                                                                        000661   25-04-04
  662                                                                                                          000662   25-04-04
  663     Return w_Total;                                                                                      000663   25-04-04
  664   end-proc;                                                                                              000664   25-04-04
  665                                                                                                          000665   25-04-04
  666                                                                                                          000666   25-04-04
  667                                                                                                          000667   25-04-04
  668                                                                                                          000668   25-04-04
  669                                                                                                          000669   25-04-04
  670                                                                                                          000670   25-04-04
  671                                                                                                          000671   25-04-04
  672                                                                                                          000672   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    14
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  673   // --------------------------------------------------------------------------                          000673   25-04-04
  674   // run the CRUD                                                                                        000674   25-04-04
  675   // --------------------------------------------------------------------------                          000675   25-04-04
  676   Dcl-Proc ExecuteCrudScreen;                                                                            000676   25-04-04
  677     Dcl-Pi ExecuteCrudScreen;                                                                            000677   25-04-04
  678       p_choice char(1);                                                                                  000678   25-04-04
  679     end-pi;                                                                                              000679   25-04-04
  680                                                                                                          000680   25-04-04
  681     If (p_choice = 'I'); // Insert Screen                                                                000681   25-04-04
  682       InsertScreen(p_choice);                                                                            000682   25-04-04
  683     EndIf;                                                                                               000683   25-04-04
  684                                                                                                          000684   25-04-04
  685     If (p_choice = 'M'); // Modify Screen                                                                000685   25-04-04
  686       ModifyScreen(p_choice);                                                                            000686   25-04-04
  687     EndIf;                                                                                               000687   25-04-04
  688                                                                                                          000688   25-04-04
  689     If (p_choice = 'D'); // Delete Screen                                                                000689   25-04-04
  690       DeleteScreen(p_choice);                                                                            000690   25-04-04
  691     EndIf;                                                                                               000691   25-04-04
  692                                                                                                          000692   25-04-04
  693     If (p_choice = 'V'); // View Screen                                                                  000693   25-04-04
  694       ViewScreen(p_choice);                                                                              000694   25-04-04
  695     EndIf;                                                                                               000695   25-04-04
  696   end-proc;                                                                                              000696   25-04-04
  697                                                                                                          000697   25-04-04
  698                                                                                                          000698   25-04-04
  699                                                                                                          000699   25-04-04
  700                                                                                                          000700   25-04-04
  701                                                                                                          000701   25-04-04
  702                                                                                                          000702   25-04-04
  703                                                                                                          000703   25-04-04
  704   // --------------------------------------------------------------------------                          000704   25-04-04
  705   // write the screen                                                                                    000705   25-04-04
  706   // --------------------------------------------------------------------------                          000706   25-04-04
  707   Dcl-Proc InsertScreen;                                                                                 000707   25-04-04
  708     Dcl-Pi InsertScreen;                                                                                 000708   25-04-04
  709       p_choice char(1);                                                                                  000709   25-04-04
  710     end-pi;                                                                                              000710   25-04-04
  711                                                                                                          000711   25-04-04
  712     Dcl-S choice char(1);                                                                                000712   25-04-04
  713                                                                                                          000713   25-04-04
  714     WriteScreen(p_choice);                                                                               000714   25-04-04
  715                                                                                                          000715   25-04-04
  716     dow (not pfkey(03));                                                                                 000716   25-04-04
  717       ProtectFields_35 = *Off;                                                                           000717   25-04-04
  718       ProtectFields_36 = *Off;                                                                           000718   25-04-04
  719       exfmt CRUDTASK;                                                                                    000719   25-04-04
  720       Select;                                                                                            000720   25-04-04
  721         When (pfkey(03));                                                                                000721   25-04-04
  722           clear CRUDTASK;                                                                                000722   25-04-04
  723           reset Initialpos;                                                                              000723   25-04-04
  724           reset Finalpos;                                                                                000724   25-04-04
  725           pfkey(03) = *Off;                                                                              000725   25-04-04
  726           choice = 'S';                                                                                  000726   25-04-04
  727           ShowScreen(choice);                                                                            000727   25-04-04
  728           leave;                                                                                         000728   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    15
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  729         When (pfkey(10));                                                                                000729   25-04-04
  730           If (ScreenValidation(p_choice) = *Off);                                                        000730   25-04-04
  731                                                                                                          000731   25-04-04
  732             // Executes window confirmation                                                              000732   25-04-04
  733             choice = 'C';                                                                                000733   25-04-04
  734             ShowWdw(choice);                                                                             000734   25-04-04
  735             If (WDWCHOICE = 'Y');                                                                        000735   25-04-04
  736               LoaddatatoDs();                                                                            000736   25-04-04
  737                                                                                                          000737   25-04-04
  738               exec sql                                                                                   000738   25-04-04
  739               INSERT INTO CRUD01TBL                                                                      000739   25-04-04
  740                 VALUES (:Ds_datacrud);                                                                   000740   25-04-04
  741                                                                                                          000741   25-04-04
  742               If (xSQLState = SUCCESS_ON_SQL);                                                           000742   25-04-04
  743                 choice = 'M'; // Message of successful                                                   000743   25-04-04
  744                 ShowWdw(choice);                                                                         000744   25-04-04
  745                 clear CRUDTASK;                                                                          000745   25-04-04
  746                 reset Initialpos;                                                                        000746   25-04-04
  747                 reset Finalpos;                                                                          000747   25-04-04
  748                 choice = 'S';                                                                            000748   25-04-04
  749                 ShowScreen(choice);                                                                      000749   25-04-04
  750                 leave;                                                                                   000750   25-04-04
  751               Else;                                                                                      000751   25-04-04
  752                 choice = 'E'; // Error Message                                                           000752   25-04-04
  753                 ShowWdw(choice);                                                                         000753   25-04-04
  754               EndIf;                                                                                     000754   25-04-04
  755             Else ;                                                                                       000755   25-04-04
  756               clear CRUDTASK;                                                                            000756   25-04-04
  757             EndIf;                                                                                       000757   25-04-04
  758           EndIf;                                                                                         000758   25-04-04
  759                                                                                                          000759   25-04-04
  760         Other;                                                                                           000760   25-04-04
  761           If (ScreenValidation(p_choice) = *On);                                                         000761   25-04-04
  762             iter;                                                                                        000762   25-04-04
  763           EndIf ;                                                                                        000763   25-04-04
  764       EndSl;                                                                                             000764   25-04-04
  765     enddo;                                                                                               000765   25-04-04
  766   end-proc;                                                                                              000766   25-04-04
  767                                                                                                          000767   25-04-04
  768                                                                                                          000768   25-04-04
  769                                                                                                          000769   25-04-04
  770   // --------------------------------------------------------------------------                          000770   25-04-04
  771   // modify screen                                                                                       000771   25-04-04
  772   // --------------------------------------------------------------------------                          000772   25-04-04
  773   Dcl-Proc ModifyScreen;                                                                                 000773   25-04-04
  774     Dcl-Pi ModifyScreen;                                                                                 000774   25-04-04
  775       p_choice char(1);                                                                                  000775   25-04-04
  776     end-pi;                                                                                              000776   25-04-04
  777                                                                                                          000777   25-04-04
  778     Dcl-S choice char(1);                                                                                000778   25-04-04
  779                                                                                                          000779   25-04-04
  780     LoaddatatoScreen();                                                                                  000780   25-04-04
  781     WriteScreen(p_choice);                                                                               000781   25-04-04
  782                                                                                                          000782   25-04-04
  783     dow (not pfkey(03));                                                                                 000783   25-04-04
  784       ProtectFields_35 = *On;                                                                            000784   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    16
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  785       exfmt CRUDTASK;                                                                                    000785   25-04-04
  786       Select;                                                                                            000786   25-04-04
  787         When (pfkey(03));                                                                                000787   25-04-04
  788           ProtectFields_35 = *Off;                                                                       000788   25-04-04
  789           clear CRUDTASK;                                                                                000789   25-04-04
  790           clear OPCTASK;                                                                                 000790   25-04-04
  791           pfkey(03) = *Off;                                                                              000791   25-04-04
  792           w_Crudfinalize = *On ;                                                                         000792   25-04-04
  793           reset Initialpos;                                                                              000793   25-04-04
  794           reset Finalpos;                                                                                000794   25-04-04
  795           choice = 'S';                                                                                  000795   25-04-04
  796           ShowScreen(choice);                                                                            000796   25-04-04
  797           leave;                                                                                         000797   25-04-04
  798         When (pfkey(10));                                                                                000798   25-04-04
  799           If (ScreenValidation(p_choice) = *Off);                                                        000799   25-04-04
  800                                                                                                          000800   25-04-04
  801             // Executes window confirmation                                                              000801   25-04-04
  802             choice = 'C';                                                                                000802   25-04-04
  803             ShowWdw(choice);                                                                             000803   25-04-04
  804             If (WDWCHOICE = 'Y');                                                                        000804   25-04-04
  805                                                                                                          000805   25-04-04
  806               exec sql                                                                                   000806   25-04-04
  807               UPDATE CRUD01TBL                                                                           000807   25-04-04
  808                 SET NAME = :NAMETASK,                                                                    000808   25-04-04
  809                     DESCR = :DESCRP,                                                                     000809   25-04-04
  810                     ENDDES = :SOLUTION,                                                                  000810   25-04-04
  811                     STARTDATE = :STARTDATE,                                                              000811   25-04-04
  812                     ENDDATE = :ENDDATE,                                                                  000812   25-04-04
  813                     STATE = :STATETASK,                                                                  000813   25-04-04
  814                     OWNER = :CurrentUser                                                                 000814   25-04-04
  815                 WHERE TASK_ID = : CRUDTASKID;                                                            000815   25-04-04
  816                                                                                                          000816   25-04-04
  817               If (xSQLState = SUCCESS_ON_SQL);                                                           000817   25-04-04
  818                 choice = 'M'; // Message of successful                                                   000818   25-04-04
  819                 ShowWdw(choice);                                                                         000819   25-04-04
  820                 clear CRUDTASK;                                                                          000820   25-04-04
  821                 clear OPCTASK;                                                                           000821   25-04-04
  822                 reset Initialpos;                                                                        000822   25-04-04
  823                 reset Finalpos;                                                                          000823   25-04-04
  824                 choice = 'S';                                                                            000824   25-04-04
  825                 ShowScreen(choice);                                                                      000825   25-04-04
  826                 w_Crudfinalize = *On ;                                                                   000826   25-04-04
  827                 leave;                                                                                   000827   25-04-04
  828               Else;                                                                                      000828   25-04-04
  829                 choice = 'E'; // Error Message                                                           000829   25-04-04
  830                 ShowWdw(choice);                                                                         000830   25-04-04
  831               EndIf;                                                                                     000831   25-04-04
  832             Else ;                                                                                       000832   25-04-04
  833               clear CRUDTASK;                                                                            000833   25-04-04
  834             EndIf;                                                                                       000834   25-04-04
  835           EndIf;                                                                                         000835   25-04-04
  836                                                                                                          000836   25-04-04
  837         Other;                                                                                           000837   25-04-04
  838           If (ScreenValidation(p_choice) = *On);                                                         000838   25-04-04
  839             iter;                                                                                        000839   25-04-04
  840           EndIf ;                                                                                        000840   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    17
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  841       EndSl;                                                                                             000841   25-04-04
  842     enddo;                                                                                               000842   25-04-04
  843   end-proc;                                                                                              000843   25-04-04
  844                                                                                                          000844   25-04-04
  845                                                                                                          000845   25-04-04
  846                                                                                                          000846   25-04-04
  847                                                                                                          000847   25-04-04
  848                                                                                                          000848   25-04-04
  849                                                                                                          000849   25-04-04
  850                                                                                                          000850   25-04-04
  851                                                                                                          000851   25-04-04
  852   // --------------------------------------------------------------------------                          000852   25-04-04
  853   // delete screen                                                                                       000853   25-04-04
  854   // --------------------------------------------------------------------------                          000854   25-04-04
  855   Dcl-Proc DeleteScreen;                                                                                 000855   25-04-04
  856     Dcl-Pi DeleteScreen;                                                                                 000856   25-04-04
  857       p_choice char(1);                                                                                  000857   25-04-04
  858     end-pi;                                                                                              000858   25-04-04
  859                                                                                                          000859   25-04-04
  860     Dcl-S choice char(1);                                                                                000860   25-04-04
  861                                                                                                          000861   25-04-04
  862     LoaddatatoScreen();                                                                                  000862   25-04-04
  863     WriteScreen(p_choice);                                                                               000863   25-04-04
  864                                                                                                          000864   25-04-04
  865     dow (not pfkey(03));                                                                                 000865   25-04-04
  866       ProtectFields_35 = *On;                                                                            000866   25-04-04
  867       ProtectFields_36 = *On;                                                                            000867   25-04-04
  868       exfmt CRUDTASK;                                                                                    000868   25-04-04
  869       Select;                                                                                            000869   25-04-04
  870         When (pfkey(03));                                                                                000870   25-04-04
  871           ProtectFields_35 = *Off;                                                                       000871   25-04-04
  872           ProtectFields_36 = *Off;                                                                       000872   25-04-04
  873           clear CRUDTASK;                                                                                000873   25-04-04
  874           clear OPCTASK;                                                                                 000874   25-04-04
  875           pfkey(03) = *Off;                                                                              000875   25-04-04
  876           w_Crudfinalize = *On ;                                                                         000876   25-04-04
  877           reset Initialpos;                                                                              000877   25-04-04
  878           reset Finalpos;                                                                                000878   25-04-04
  879           choice = 'S';                                                                                  000879   25-04-04
  880           ShowScreen(choice);                                                                            000880   25-04-04
  881           leave;                                                                                         000881   25-04-04
  882         When (pfkey(10));                                                                                000882   25-04-04
  883           If (ScreenValidation(p_choice) = *Off);                                                        000883   25-04-04
  884                                                                                                          000884   25-04-04
  885             // Executes window confirmation                                                              000885   25-04-04
  886             choice = 'C';                                                                                000886   25-04-04
  887             ShowWdw(choice);                                                                             000887   25-04-04
  888             If (WDWCHOICE = 'Y');                                                                        000888   25-04-04
  889                                                                                                          000889   25-04-04
  890               exec sql                                                                                   000890   25-04-04
  891               DELETE FROM CRUD01TBL WHERE TASK_ID = : CRUDTASKID;                                        000891   25-04-04
  892                                                                                                          000892   25-04-04
  893               If (xSQLState = SUCCESS_ON_SQL);                                                           000893   25-04-04
  894                 ShowWdw(p_choice);                                                                       000894   25-04-04
  895                 clear CRUDTASK;                                                                          000895   25-04-04
  896                 clear OPCTASK;                                                                           000896   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    18
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  897                 reset Initialpos;                                                                        000897   25-04-04
  898                 reset Finalpos;                                                                          000898   25-04-04
  899                 choice = 'S';                                                                            000899   25-04-04
  900                 ShowScreen(choice);                                                                      000900   25-04-04
  901                 w_Crudfinalize = *On ;                                                                   000901   25-04-04
  902                 leave;                                                                                   000902   25-04-04
  903               Else;                                                                                      000903   25-04-04
  904                 choice = 'E'; // Error Message                                                           000904   25-04-04
  905                 ShowWdw(choice);                                                                         000905   25-04-04
  906               EndIf;                                                                                     000906   25-04-04
  907             Else ;                                                                                       000907   25-04-04
  908               clear CRUDTASK;                                                                            000908   25-04-04
  909             EndIf;                                                                                       000909   25-04-04
  910           EndIf;                                                                                         000910   25-04-04
  911                                                                                                          000911   25-04-04
  912         Other;                                                                                           000912   25-04-04
  913           If (ScreenValidation(p_choice) = *On);                                                         000913   25-04-04
  914             iter;                                                                                        000914   25-04-04
  915           EndIf ;                                                                                        000915   25-04-04
  916       EndSl;                                                                                             000916   25-04-04
  917     enddo;                                                                                               000917   25-04-04
  918   end-proc;                                                                                              000918   25-04-04
  919                                                                                                          000919   25-04-04
  920                                                                                                          000920   25-04-04
  921                                                                                                          000921   25-04-04
  922                                                                                                          000922   25-04-04
  923                                                                                                          000923   25-04-04
  924                                                                                                          000924   25-04-04
  925                                                                                                          000925   25-04-04
  926   // --------------------------------------------------------------------------                          000926   25-04-04
  927   // view the screen                                                                                     000927   25-04-04
  928   // --------------------------------------------------------------------------                          000928   25-04-04
  929   Dcl-Proc ViewScreen;                                                                                   000929   25-04-04
  930     Dcl-Pi ViewScreen;                                                                                   000930   25-04-04
  931       p_choice char(1);                                                                                  000931   25-04-04
  932     end-pi;                                                                                              000932   25-04-04
  933                                                                                                          000933   25-04-04
  934     Dcl-S choice char(1);                                                                                000934   25-04-04
  935                                                                                                          000935   25-04-04
  936     LoaddatatoScreen();                                                                                  000936   25-04-04
  937     WriteScreen(p_choice);                                                                               000937   25-04-04
  938                                                                                                          000938   25-04-04
  939     dow (not pfkey(03));                                                                                 000939   25-04-04
  940       ProtectFields_35 = *On;                                                                            000940   25-04-04
  941       ProtectFields_36 = *On;                                                                            000941   25-04-04
  942       exfmt CRUDTASK;                                                                                    000942   25-04-04
  943       If (pfkey(03));                                                                                    000943   25-04-04
  944         ProtectFields_35 = *Off;                                                                         000944   25-04-04
  945         ProtectFields_36 = *Off;                                                                         000945   25-04-04
  946         clear CRUDTASK;                                                                                  000946   25-04-04
  947         clear OPCTASK;                                                                                   000947   25-04-04
  948         pfkey(03) = *Off;                                                                                000948   25-04-04
  949         w_Crudfinalize = *On ;                                                                           000949   25-04-04
  950         reset Initialpos;                                                                                000950   25-04-04
  951         reset Finalpos;                                                                                  000951   25-04-04
  952         choice = 'S';                                                                                    000952   25-04-04
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    19
Record  *...+... 1 ...+... 2 ...+... 3 ...+... 4 ...+... 5 ...+... 6 ...+... 7 ...+... 8 ...+... 9 ...+... 0   SEQNBR  Last change
  953         ShowScreen(choice);                                                                              000953   25-04-04
  954         leave;                                                                                           000954   25-04-04
  955       EndIf;                                                                                             000955   25-04-04
  956     enddo;                                                                                               000956   25-04-04
  957   end-proc;                                                                                              000957   25-04-04
  958                                                                                                          000958   25-04-04
  959                                                                                                          000959   25-04-04
  960                                                                                                          000960   25-04-04
  961                                                                                                          000961   25-04-04
  962                                                                                                          000962   25-04-04
  963                                                                                                          000963   25-04-04
  964                                                                                                          000964   25-04-04
  965                                                                                                          000965   25-04-04
  966   // --------------------------------------------------------------------------                          000966   25-04-04
  967   // load screen data                                                                                    000967   25-04-04
  968   // --------------------------------------------------------------------------                          000968   25-04-04
  969   Dcl-Proc LoaddatatoScreen;                                                                             000969   25-04-04
  970     clear CRUDTASK;                                                                                      000970   25-04-04
  971     CRUDTASKID = Ds_datacrud.Task_id;                                                                    000971   25-04-04
  972     NAMETASK = Ds_datacrud.Name;                                                                         000972   25-04-04
  973     DESCRP = Ds_datacrud.Descr;                                                                          000973   25-04-04
  974     SOLUTION = Ds_datacrud.Enddes;                                                                       000974   25-04-04
  975     STARTDATE = Ds_datacrud.Startdate;                                                                   000975   25-04-04
  976     ENDDATE = Ds_datacrud.Enddate;                                                                       000976   25-04-04
  977     STATETASK = Ds_datacrud.State;                                                                       000977   25-04-04
  978   end-proc ;                                                                                             000978   25-04-04
  979                                                                                                          000979   25-04-04
  980                                                                                                          000980   25-04-04
  981                                                                                                          000981   25-04-04
  982                                                                                                          000982   25-04-04
  983                                                                                                          000983   25-04-04
  984                                                                                                          000984   25-04-04
  985                                                                                                          000985   25-04-04
  986                                                                                                          000986   25-04-04
  987                                                                                                          000987   25-04-04
  988   // --------------------------------------------------------------------------                          000988   25-04-04
  989   // load data to data structure                                                                         000989   25-04-04
  990   // --------------------------------------------------------------------------                          000990   25-04-04
  991   Dcl-Proc LoaddatatoDs;                                                                                 000991   25-04-04
  992     clear Ds_datacrud;                                                                                   000992   25-04-04
  993     Ds_datacrud.Task_id = CRUDTASKID;                                                                    000993   25-04-04
  994     Ds_datacrud.Name = %trim(NAMETASK);                                                                  000994   25-04-04
  995     Ds_datacrud.Descr = %trim(DESCRP);                                                                   000995   25-04-04
  996     Ds_datacrud.Enddes = %trim(SOLUTION);                                                                000996   25-04-04
  997     Ds_datacrud.Startdate = STARTDATE;                                                                   000997   25-04-04
  998     Ds_datacrud.Enddate = ENDDATE;                                                                       000998   25-04-04
  999     Ds_datacrud.State = STATETASK;                                                                       000999   25-04-04
 1000     Ds_datacrud.Owner = CurrentUser;                                                                     001000   25-04-04
 1001   end-proc;                                                                                              001001   25-04-04
                                * * * * *  E N D  O F  S O U R C E  * * * * *
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    20
                                               CROSS REFERENCE
Data Names                    Define    Reference
A                                ****     TABLE
                                          303 307
ACTIVATESUBFILE                  526      RPG PROCEDURE
CENTER                           239      RPG PROCEDURE
CENTEREDTEXT                     248      CHARACTER(80) IN RPG PROCEDURE CENTER
CHOICE                           88       CHARACTER(1) IN RPG PROCEDURE MAINLINE
CHOICE                           273      CHARACTER(1) IN RPG PROCEDURE SHOWSUBFILE
CHOICE                           712      CHARACTER(1) IN RPG PROCEDURE INSERTSCREEN
CHOICE                           778      CHARACTER(1) IN RPG PROCEDURE MODIFYSCREEN
CHOICE                           860      CHARACTER(1) IN RPG PROCEDURE DELETESCREEN
CHOICE                           934      CHARACTER(1) IN RPG PROCEDURE VIEWSCREEN
COUNT                            556      NUMERIC(2,0) IN RPG PROCEDURE FILLSFL
CRUDTASKID                       9        DECIMAL(10,0)
                                          433 815 891
CRUD01TBL                        ****     TABLE
                                          307 355 367 379 432 739 807 891
CURRENTUSER                      76       CHARACTER(10)
                                          814
DATATOSFL                        613      RPG PROCEDURE
DATEGREATERTHANERROR_34          23       CHARACTER(1) IN DSPIND
DELETESCREEN                     855      RPG PROCEDURE
DESCR                            ****     COLUMN
                                          809
DESCRP                           9        CHARACTER(150)
                                          809
DS_DATACRUD                      ****     354 366 378 740
DS_SQLSTATE                      32       STRUCTURE
DS_TASKDATA                      43       STRUCTURE
                                          580 591
DSPIND                           13       STRUCTURE
END_DATE                         47       NUMERIC(8,0) IN DS_TASKDATA
ENDDATE                          9        DECIMAL(8,0)
                                          812
ENDDATE                          ****     COLUMN
                                          812
ENDDATEERROR_33                  22       CHARACTER(1) IN DSPIND
ENDDES                           ****     COLUMN
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    21
                                               CROSS REFERENCE
                                          810
EXECUTECRUDSCREEN                676      RPG PROCEDURE
FILLSFL                          551      RPG PROCEDURE
FINALPOS                         59       NUMERIC(10,0)
                                          311
FOOTTEXT                         9        CHARACTER(50)
GETTOTALRECORDS                  634      RPG PROCEDURE
INDERRORS                        26       CHARACTER(20) IN DSPIND
INITIALPOS                       58       NUMERIC(10,0)
                                          310
INITPOSITION                     247      NUMERIC(2,0) IN RPG PROCEDURE CENTER
INSERTSCREEN                     707      RPG PROCEDURE
LASTRRN                          558      NUMERIC(10,0) IN RPG PROCEDURE FILLSFL
LENBLANKS                        246      NUMERIC(2,0) IN RPG PROCEDURE CENTER
LOADDATATODS                     991      RPG PROCEDURE
LOADDATATOSCREEN                 969      RPG PROCEDURE
MAINLINE                         86       RPG PROCEDURE
MODIFYSCREEN                     773      RPG PROCEDURE
NAME                             ****     COLUMN
                                          808
NAMETASK                         45       CHARACTER(20) IN DS_TASKDATA
NAMETASK                         9        CHARACTER(10)
                                          808
NODATA_ON_SQL                    39       CHARACTER(2) CONSTANT
OPCTASK                          9        CHARACTER(1)
OWNER                            ****     COLUMN
                                          814
P_CHOICE                         112      CHARACTER(1) IN RPG PROCEDURE WRITESCREEN
P_CHOICE                         167      CHARACTER(1) IN RPG PROCEDURE SHOWSCREEN
P_CHOICE                         196      CHARACTER(1) IN RPG PROCEDURE SHOWWDW
P_CHOICE                         269      CHARACTER(1) IN RPG PROCEDURE SHOWSUBFILE
P_CHOICE                         415      CHARACTER(1) IN RPG PROCEDURE SCREENVALIDATION
P_CHOICE                         678      CHARACTER(1) IN RPG PROCEDURE EXECUTECRUDSCREEN
P_CHOICE                         709      CHARACTER(1) IN RPG PROCEDURE INSERTSCREEN
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    22
                                               CROSS REFERENCE
P_CHOICE                         775      CHARACTER(1) IN RPG PROCEDURE MODIFYSCREEN
P_CHOICE                         857      CHARACTER(1) IN RPG PROCEDURE DELETESCREEN
P_CHOICE                         931      CHARACTER(1) IN RPG PROCEDURE VIEWSCREEN
PAR_LENGTH                       242      NUMERIC(2,0) IN RPG PROCEDURE CENTER
PAR_SQLCUSTOMIZED                553      CHARACTER(500) IN RPG PROCEDURE FILLSFL
                                          571
PAR_TEXT                         241      CHARACTER(80) IN RPG PROCEDURE CENTER
PERPAGE                          70       SMALL INTEGER PRECISION(4,0) CONSTANT
PINDICATORS                      12
PREVFINALPOS                     63       NUMERIC(10,0)
PREVINITIALPOS                   62       NUMERIC(10,0)
PROTECTFIELDS_35                 24       CHARACTER(1) IN DSPIND
PROTECTFIELDS_36                 25       CHARACTER(1) IN DSPIND
PSQLSTATE                        30
QRY                              ****     STATEMENT
                                          649 652
QRYC                             652      CURSOR FOR QRY
                                          655 658 661
RNUM                             ****     COLUMN
                                          306 310
SCREENVALIDATION                 413      RPG PROCEDURE
SFLCLR                           17       CHARACTER(1) IN DSPIND
SFLDSP                           15       CHARACTER(1) IN DSPIND
SFLDSPCTL                        16       CHARACTER(1) IN DSPIND
SFLEND                           18       CHARACTER(1) IN DSPIND
SFLENDDATE                       9        DECIMAL(8,0)
SFLINITIAL                       507      RPG PROCEDURE
SFLSTATE                         9        DECIMAL(2,0)
SFLSTRDATE                       9        DECIMAL(8,0)
SFLTASKID                        9        DECIMAL(10,0)
                                          356 368 380
SFLTASKNAM                       9        CHARACTER(10)
SHOWSCREEN                       165      RPG PROCEDURE
SHOWSUBFILE                      267      RPG PROCEDURE
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    23
                                               CROSS REFERENCE
SHOWWDW                          194      RPG PROCEDURE
SOLUTION                         9        CHARACTER(150)
                                          810
SQLCUSTOMIZED                    488      CHARACTER(500) IN RPG PROCEDURE SUBFILESTART
SQLCUSTOMIZED                    640      CHARACTER(500) IN RPG PROCEDURE GETTOTALRECORDS
                                          649
START_DATE                       46       NUMERIC(8,0) IN DS_TASKDATA
STARTDATE                        9        DECIMAL(8,0)
                                          811
STARTDATE                        ****     COLUMN
                                          811
STARTDATEERROR_32                21       CHARACTER(1) IN DSPIND
STATE                            ****     COLUMN
                                          813
STATETASK                        9        DECIMAL(1,0)
                                          813
SUBFILESTART                     483      RPG PROCEDURE
SUCCESS_ON_SQL                   37       CHARACTER(2) CONSTANT
TASK_CURSOR                      574      CURSOR FOR YOURQUERY
                                          577 580 591 601
TASK_ID                          ****     COLUMN
                                          356 368 380 433 815 891
TASKID                           44       NUMERIC(10,0) IN DS_TASKDATA
TASKIDEXISTERROR_31              20       CHARACTER(1) IN DSPIND
TASKRRN                          55       NUMERIC(3,0)
TASKSTATE                        48       NUMERIC(1,0) IN DS_TASKDATA
                                 ****     TABLE
TITLE1                           9        CHARACTER(50)
TITLE2                           9        CHARACTER(50)
TITLE3                           9        CHARACTER(50)
TURNOFFERRORS                    467      RPG PROCEDURE
VIEWSCREEN                       929      RPG PROCEDURE
W_CRUDFINALIZE                   73       CHARACTER(1)
W_EXIST                          272      CHARACTER(1) IN RPG PROCEDURE SHOWSUBFILE
                                          302
W_EXISTS                         419      CHARACTER(1) IN RPG PROCEDURE SCREENVALIDATION
                                          431
W_TOTAL                          638      NUMERIC(10,0) IN RPG PROCEDURE GETTOTALRECORDS
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    24
                                               CROSS REFERENCE
                                          658
W_VALIDISNOTOK                   418      CHARACTER(1) IN RPG PROCEDURE SCREENVALIDATION
W_WHERESFL                       66       CHARACTER(500)
WARNING_ON_SQL                   38       CHARACTER(2) CONSTANT
WDWCHOICE                        9        CHARACTER(1)
WDWMSG1                          9        CHARACTER(40)
WDWMSG2                          9        CHARACTER(40)
WDWTEXT1                         9        CHARACTER(40)
WDWTEXT2                         9        CHARACTER(40)
WRITESCREEN                      110      RPG PROCEDURE
XSQLSTATE                        33       CHARACTER(2) IN DS_SQLSTATE
YOURQUERY                        ****     STATEMENT
                                          571 574
5770ST1 V7R5M0 220415            Create SQL ILE RPG Object         CRUD01RPG                   25-04-11 10:38:41          Page    25
                                             DIAGNOSTIC MESSAGES
MSG ID  SEV  RECORD  TEXT
SQL1001  30      52  External file definition for CRUD01TBL not found.
SQL1103  10     307  Position 26 Column definitions for table CRUD01TBL in
                     *LIBL not found.
SQL0312  30     354  Position 31 Variable DS_DATACRUD not defined or not
                     usable for reason code 1.
SQL0312  30     366  Position 31 Variable DS_DATACRUD not defined or not
                     usable for reason code 1.
SQL0312  30     378  Position 31 Variable DS_DATACRUD not defined or not
                     usable for reason code 1.
SQL1103  10     432  Position 14 Column definitions for table CRUD01TBL in
                     *LIBL not found.
SQL0312  30     740  Position 24 Variable DS_DATACRUD not defined or not
                     usable for reason code 1.
SQL1103  10     807  Position 20 Column definitions for table CRUD01TBL in
                     *LIBL not found.
SQL1103  10     891  Position 25 Column definitions for table CRUD01TBL in
                     *LIBL not found.
                    Message Summary
  Total     Info   Warning      Error   Severe  Terminal
      9        0         4          0        5         0
30 level severity errors found in source
 1001 Source records processed
                               * * * * *  E N D  O F  L I S T I N G  * * * * *
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

